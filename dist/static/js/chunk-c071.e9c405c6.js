(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-c071"],{"+D2/":function(t,e,n){},"8ELX":function(t,e,n){"use strict";n.d(e,"b",function(){return c}),n.d(e,"c",function(){return l}),n.d(e,"d",function(){return u}),n.d(e,"a",function(){return m});var i=n("4d7F"),a=n.n(i),o=n("t3Un"),r=n("JDVc"),s="/routings";function c(){return new a.a(function(t,e){var n=[],i="",a=r.c;!function r(c){(function(t){return Object(o.a)({url:s,method:"GET",params:t})})(c).then(function(e){var o=(e=e||[]).length;o>0?(n=n.concat(e),(i=e[o-1]||{}).id&&r({after:i.id,limit:a})):t(n)}).catch(function(){e()})}({after:"",limit:a})})}function l(t){return Object(o.a)({url:s+"/"+t,method:"GET"})}function u(t){return Object(o.a)({url:s,method:"PUT",data:t})}function m(t){return Object(o.a)({url:s+"/"+t,method:"DELETE"})}},"8YzG":function(t,e,n){"use strict";var i=n("Wd2a");n.n(i).a},E7f7:function(t,e,n){"use strict";var i=n("8ELX"),a=n("fqLP"),o=n("TsPW"),r=n("7Qib"),s=n("JDVc");var c={name:"routingForm",props:{showType:{type:String,default:s.d.create},editItem:{type:Object}},data:function(){return{loading:!0,submitting:!1,rules:{name:[{required:!0,message:"请填写名称",trigger:"change"}],clusterID:[{required:!0,message:"请选择cluster",trigger:"change"}],api:[{required:!0,message:"请选择Api",trigger:"change"}],trafficRate:[{required:!0,message:"请填写trafficRate",trigger:"change"},{type:"number",message:"请输入数字",trigger:"change"}]},rules2:{},tempItem:{id:void 0,name:"",clusterID:void 0,api:void 0,conditions:[],strategy:s.v.split,trafficRate:void 0,status:!0},routingStrategyConstant:s.u,clusterList:[],apiList:[],cmpConstant:s.b,sourceConstant:s.r,tempCondition:{parameter:{name:"",source:"",index:""},cmp:"",expect:""},tempConditionIndex:-1,dialogFormVisible:!1,dialogStatus:s.d.create}},computed:{isShow:function(){return this._isShow()},isCreate:function(){return this._isCreate()},isUpdate:function(){return this._isUpdate()},dialogStatusTitle:function(){return s.e[this.dialogStatus]}},created:function(){this.init()},watch:{editItem:function(t,e){this.tempItem=Object(r.e)(this.tempItem,Object(r.a)(t)),this.tempItem.status=this.tempItem.status==s.s.up,this.loading=!1,this.submitting=!1,this.initShow()}},methods:{init:function(){var t=this;this._isShow()?this.rules={}:this._isCreate()&&(this.loading=!1),a.b().then(function(e){t.clusterList=e,t.initShow()}),o.b().then(function(e){t.apiList=e,t.initShow()})},initShow:function(){if(this._isShow()){var t=Object(r.f)(this.clusterList,this.tempItem.clusterID);t&&this.$set(this.tempItem,"clusterName",t.name);var e=Object(r.f)(this.apiList,this.tempItem.api);e&&this.$set(this.tempItem,"apiName",e.name)}},goList:function(){this.$router.replace({path:"/routing"}),this.$destroy()},goEdit:function(){this.$router.push({path:"/routing/edit",query:{id:this.tempItem.id}})},createItem:function(t){var e=this;this.submitting||this.$refs[t].validate(function(t){if(!t)return!1;e._doCreateItem()})},_doCreateItem:function(){var t=this,e=Object(r.a)(this.tempItem);e.status=e.status?s.s.up:s.s.down,this.submitting=!0,i.d(e).then(function(){t.$message({type:"success",message:"创建成功!"}),setTimeout(function(){t.goList()},2e3)}).catch(function(){t.submitting=!1})},updateItem:function(t){var e=this;this.submitting||this.$refs[t].validate(function(t){if(!t)return!1;e._doUpdateItem()})},_doUpdateItem:function(){var t=this,e=Object(r.a)(this.tempItem);e.status=e.status?s.s.up:s.s.down,this.submitting=!0,i.d(e).then(function(){t.$message({type:"success",message:"修改成功!"}),setTimeout(function(){t.goList()},2e3)}).catch(function(){t.submitting=!1})},handleCreateCondition:function(){var t=this;this.initTempCondition(),this.dialogStatus=s.d.create,this.dialogFormVisible=!0,this.$nextTick(function(){t.$refs.dataFormCondition.clearValidate()})},handleDeleteCondition:function(t,e){var n=this;this.$confirm("是否删除该表达式？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){n.tempItem.conditions.splice(e,1)})},handleUpdateCondition:function(t,e){this.initTempCondition(),this.tempCondition=Object(r.a)(t),this.dialogFormVisible=!0,this.dialogStatus=s.d.update},createItemCondition:function(t){var e=this;this.$refs[t].validate(function(t){if(!t)return!1;var n=Object(r.a)(e.tempCondition);5==n.parameter.source?n.parameter.name="":n.parameter.index=0,e.tempItem.conditions.push(n),e.dialogFormVisible=!1,e.initTempCondition()})},updateItemCondition:function(t){var e=this;this.$refs[t].validate(function(t){if(!t)return!1;var n=Object(r.a)(e.tempCondition);5==n.parameter.source?n.parameter.name="":n.parameter.index=0,e.tempItem.conditions.splice(e.tempConditionIndex,1,n),e.initTempCondition(),e.dialogFormVisible=!1})},initTempCondition:function(){this.tempCondition={parameter:{name:"",source:"",index:""},cmp:"",expect:""}},_isUpdate:function(){return this.showType===s.d.update},_isShow:function(){return this.showType===s.d.show},_isCreate:function(){return this.showType===s.d.create}}},l=(n("k6g3"),n("KHd+")),u=Object(l.a)(c,function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("el-form",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],ref:"dataForm",attrs:{rules:t.rules,model:t.tempItem,"label-width":"150px"}},[n("el-form-item",{attrs:{label:"名称",prop:"name"}},[t.isShow?n("span",[t._v(t._s(t.tempItem.name))]):n("el-input",{staticStyle:{width:"200px"},attrs:{placeholder:"路由名称"},model:{value:t.tempItem.name,callback:function(e){t.$set(t.tempItem,"name",e)},expression:"tempItem.name"}})],1),t._v(" "),n("el-form-item",{attrs:{label:"绑定到的接口",prop:"api"}},[t.isShow?n("span",[t._v(t._s(t.tempItem.apiName))]):[n("el-select",{staticStyle:{width:"200px"},attrs:{placeholder:"绑定到的接口"},model:{value:t.tempItem.api,callback:function(e){t.$set(t.tempItem,"api",e)},expression:"tempItem.api"}},t._l(t.apiList,function(t){return n("el-option",{key:t.id,attrs:{value:t.id,label:t.name}})}),1)]],2),t._v(" "),n("el-form-item",{attrs:{label:"路由到新集群",prop:"clusterID"}},[t.isShow?n("span",[t._v(t._s(t.tempItem.clusterName))]):[n("el-select",{attrs:{placeholder:"选择绑定到的集群"},model:{value:t.tempItem.clusterID,callback:function(e){t.$set(t.tempItem,"clusterID",t._n(e))},expression:"tempItem.clusterID"}},t._l(t.clusterList,function(t,e){return n("el-option",{key:t.id,attrs:{label:t.name,value:t.id}})}),1)]],2),t._v(" "),n("el-form-item",{attrs:{label:"路由策略"}},[t.isShow?n("span",[t._v(t._s(t.tempItem.strategy))]):[n("el-select",{staticStyle:{width:"200px"},attrs:{placeholder:"选择路由策略"},model:{value:t.tempItem.strategy,callback:function(e){t.$set(t.tempItem,"strategy",t._n(e))},expression:"tempItem.strategy"}},t._l(t.routingStrategyConstant,function(t){return n("el-option",{key:t.value,attrs:{value:t.value,label:t.title}})}),1)]],2),t._v(" "),n("el-form-item",{attrs:{label:"路由流量的比例",prop:"trafficRate"}},["show"==t.showType?n("span",[t._v(t._s(t.tempItem.trafficRate))]):n("el-input",{staticStyle:{width:"200px"},attrs:{placeholder:"例如：50"},model:{value:t.tempItem.trafficRate,callback:function(e){t.$set(t.tempItem,"trafficRate",t._n(e))},expression:"tempItem.trafficRate"}})],1),t._v(" "),n("el-form-item",{attrs:{label:"路由匹配条件"}},[t.tempItem.conditions&&t.tempItem.conditions.length>0?[n("el-table",{staticStyle:{width:"900px"},attrs:{data:t.tempItem.conditions,border:""}},[n("el-table-column",{attrs:{label:"数据源"},scopedSlots:t._u([{key:"default",fn:function(e){return[n("span",[t._v(t._s(t._f("sourceFilter")(e.row.parameter.source)))])]}}])}),t._v(" "),n("el-table-column",{attrs:{label:"关键词"},scopedSlots:t._u([{key:"default",fn:function(e){return[n("span",[t._v(t._s(e.row.parameter.name))])]}}])}),t._v(" "),n("el-table-column",{attrs:{label:"路径Index"},scopedSlots:t._u([{key:"default",fn:function(e){return[n("span",[t._v(t._s(e.row.parameter.index))])]}}])}),t._v(" "),n("el-table-column",{attrs:{label:"操作符"},scopedSlots:t._u([{key:"default",fn:function(e){return[n("span",[t._v(t._s(t._f("cmpFilter")(e.row.cmp)))])]}}])}),t._v(" "),n("el-table-column",{attrs:{label:"填写表达式"},scopedSlots:t._u([{key:"default",fn:function(e){return[n("span",[t._v(t._s(e.row.expect))])]}}])}),t._v(" "),t.isShow?t._e():n("el-table-column",{attrs:{label:"操作",width:"150"},scopedSlots:t._u([{key:"default",fn:function(e){return[n("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(n){t.handleUpdateCondition(e.row,e.$index)}}},[t._v("修改\n                            ")]),t._v(" "),n("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(n){t.handleDeleteCondition(e.row,e.$index)}}},[t._v("删除\n                            ")])]}}])})],1),t._v(" "),t.isShow?t._e():n("el-button",{attrs:{type:"text"},on:{click:t.handleCreateCondition}},[t._v("新增匹配条件\n                ")])]:[t.isShow?t._e():n("el-button",{attrs:{type:"text"},on:{click:t.handleCreateCondition}},[t._v("新增匹配条件\n                ")])]],2),t._v(" "),n("el-form-item",{attrs:{label:"路由状态"}},[n("el-switch",{attrs:{disabled:t.isShow,"active-color":"#13ce66","inactive-color":"#f1f1f1"},model:{value:t.tempItem.status,callback:function(e){t.$set(t.tempItem,"status",e)},expression:"tempItem.status"}}),t._v(" "),n("el-tooltip",{directives:[{name:"show",rawName:"v-show",value:!t.isShow,expression:"!isShow"}],staticClass:"item",attrs:{effect:"dark",placement:"top-start"}},[n("div",{attrs:{slot:"content"},slot:"content"},[t._v("只有开关开着，路由才能生效。")]),t._v(" "),n("i",{staticClass:"el-icon-info",staticStyle:{"margin-left":"10px",color:"#909399"}})])],1),t._v(" "),n("div",{staticStyle:{"margin-left":"70px"}},[n("el-button",{on:{click:t.goList}},[t._v("返回")]),t._v(" "),t.isShow?n("el-button",{attrs:{type:"primary"},on:{click:function(e){t.goEdit()}}},[t._v("编辑")]):t._e(),t._v(" "),t.isCreate?n("el-button",{attrs:{loading:t.submitting,type:"primary"},on:{click:function(e){t.createItem("dataForm")}}},[t._v("提交\n            ")]):t.isUpdate?n("el-button",{attrs:{loading:t.submitting,type:"primary"},on:{click:function(e){t.updateItem("dataForm")}}},[t._v("提交\n            ")]):t._e()],1)],1),t._v(" "),n("el-dialog",{attrs:{title:t.dialogStatusTitle,visible:t.dialogFormVisible,"close-on-click-modal":!1},on:{"update:visible":function(e){t.dialogFormVisible=e}}},[n("el-form",{ref:"dataFormCondition",attrs:{rules:t.rules2,model:t.tempCondition,inline:!0}},[n("el-form-item",{staticStyle:{width:"150px"},attrs:{label:"数据源"}},[n("el-select",{attrs:{placeholder:"placeholder"},model:{value:t.tempCondition.parameter.source,callback:function(e){t.$set(t.tempCondition.parameter,"source",e)},expression:"tempCondition.parameter.source"}},t._l(t.sourceConstant,function(t){return n("el-option",{key:t.value,attrs:{label:t.title,value:t.value}})}),1)],1),t._v(" "),5!=t.tempCondition.parameter.source?n("el-form-item",{staticStyle:{width:"150px"},attrs:{label:"关键词"}},[n("el-input",{model:{value:t.tempCondition.parameter.name,callback:function(e){t.$set(t.tempCondition.parameter,"name",e)},expression:"tempCondition.parameter.name"}})],1):n("el-form-item",{staticStyle:{width:"150px"},attrs:{label:"路径Index"}},[n("el-input",{staticStyle:{width:"80%"},model:{value:t.tempCondition.parameter.index,callback:function(e){t.$set(t.tempCondition.parameter,"index",t._n(e))},expression:"tempCondition.parameter.index"}}),t._v(" "),n("el-tooltip",{staticClass:"item",attrs:{effect:"dark",placement:"top-start"}},[n("div",{attrs:{slot:"content"},slot:"content"},[t._v("\n                        http://example.com/path1/path2/path3?xxx=aa,填写1匹配path1，2匹配path2，3匹配path3\n                    ")]),t._v(" "),n("i",{staticClass:"el-icon-info",staticStyle:{"margin-left":"10px",color:"#909399"}})])],1),t._v(" "),n("el-form-item",{staticStyle:{width:"100px"},attrs:{label:"操作符"}},[n("el-select",{attrs:{placeholder:"操作符"},model:{value:t.tempCondition.cmp,callback:function(e){t.$set(t.tempCondition,"cmp",e)},expression:"tempCondition.cmp"}},t._l(t.cmpConstant,function(t){return n("el-option",{key:t.value,attrs:{label:t.title,value:t.value}})}),1)],1),t._v(" "),n("el-form-item",{staticStyle:{width:"200px"},attrs:{label:"表达式"}},[n("el-input",{attrs:{placeholder:"placeholder"},model:{value:t.tempCondition.expect,callback:function(e){t.$set(t.tempCondition,"expect",e)},expression:"tempCondition.expect"}})],1)],1),t._v(" "),n("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[n("el-button",{on:{click:function(e){t.dialogFormVisible=!1}}},[t._v("取 消")]),t._v(" "),"create"==t.dialogStatus?n("el-button",{attrs:{type:"primary"},on:{click:function(e){t.createItemCondition("dataFormCondition")}}},[t._v("\n                提交\n            ")]):t._e(),t._v(" "),"update"==t.dialogStatus?n("el-button",{attrs:{type:"primary"},on:{click:function(e){t.updateItemCondition("dataFormCondition")}}},[t._v("\n                提交\n            ")]):t._e()],1)],1)],1)},[],!1,null,"9c89f81e",null);u.options.__file="RoutingForm.vue";e.a=u.exports},TsPW:function(t,e,n){"use strict";n.d(e,"b",function(){return c}),n.d(e,"c",function(){return l}),n.d(e,"d",function(){return u}),n.d(e,"a",function(){return m});var i=n("4d7F"),a=n.n(i),o=n("t3Un"),r=n("JDVc"),s="/apis";function c(){return new a.a(function(t,e){var n=[],i="",a=r.c;!function r(c){(function(t){return Object(o.a)({url:s,method:"GET",params:t})})(c).then(function(e){var o=(e=e||[]).length;o>0?(n=n.concat(e),(i=e[o-1]||{}).id&&r({after:i.id,limit:a})):t(n)}).catch(function(){e()})}({after:"",limit:a})})}function l(t){return Object(o.a)({url:s+"/"+t,method:"GET"})}function u(t){return Object(o.a)({url:s,method:"PUT",data:t})}function m(t){return Object(o.a)({url:s+"/"+t,method:"DELETE"})}},Wd2a:function(t,e,n){},bz1H:function(t,e,n){"use strict";n.r(e);var i=n("E7f7"),a=n("8ELX"),o={name:"routingShow",data:function(){return{item:{}}},components:{RoutingForm:i.a},created:function(){this.init()},watch:{$route:function(t,e){"routingShow"!=t.name&&this.$destroy()}},methods:{init:function(){var t=this;this.id=this.$route.query.id;var e=this.id;e&&a.c(e).then(function(e){e=e||{},t.item=e})}}},r=(n("8YzG"),n("KHd+")),s=Object(r.a)(o,function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"app-container"},[n("routing-form",{attrs:{"show-type":"show",editItem:t.item},on:{"update:editItem":function(e){t.item=e}}})],1)},[],!1,null,"9b90305e",null);s.options.__file="show.vue";e.default=s.exports},fqLP:function(t,e,n){"use strict";n.d(e,"b",function(){return c}),n.d(e,"d",function(){return l}),n.d(e,"e",function(){return u}),n.d(e,"a",function(){return m}),n.d(e,"c",function(){return d});var i=n("4d7F"),a=n.n(i),o=n("t3Un"),r=n("JDVc"),s="/clusters";function c(){return new a.a(function(t,e){var n=[],i="",a=r.c;!function r(c){(function(t){return Object(o.a)({url:s,method:"GET",params:t})})(c).then(function(e){var o=(e=e||[]).length;o>0?(n=n.concat(e),(i=e[o-1]||{}).id&&r({after:i.id,limit:a})):t(n)}).catch(function(){e()})}({after:"",limit:a})})}function l(t){return Object(o.a)({url:s+"/"+t,method:"GET"})}function u(t){return Object(o.a)({url:s,method:"PUT",data:t})}function m(t){return Object(o.a)({url:s+"/"+t,method:"DELETE"})}function d(t){return Object(o.a)({url:s+"/"+t+"/binds",method:"GET"})}},k6g3:function(t,e,n){"use strict";var i=n("+D2/");n.n(i).a},t3Un:function(t,e,n){"use strict";var i=n("4d7F"),a=n.n(i),o=n("vDqi"),r=n.n(o),s=n("XJYT"),c=r.a.create({baseURL:"/v1",timeout:6e4});c.interceptors.request.use(function(t){return t},function(t){console.error(t),a.a.reject(t)}),c.interceptors.response.use(function(t){var e=t.data||{};t.headers;return 0===e.code?e.data:(Object(s.Message)({message:e.data,type:"error",duration:5e3}),a.a.reject("error"))},function(t){return Object(s.Message)({message:t.data||"网络异常",type:"error",duration:5e3}),a.a.reject(t)}),e.a=c}}]);