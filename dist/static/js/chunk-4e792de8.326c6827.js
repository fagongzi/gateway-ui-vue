(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-4e792de8"],{"40ce":function(t,e,a){},"42e2":function(t,e,a){"use strict";var i=a("476e"),s=a.n(i);s.a},"476a":function(t,e,a){"use strict";var i=a("ac70"),s=a.n(i);s.a},"476e":function(t,e,a){},"4ec3":function(t,e,a){"use strict";a.d(e,"b",function(){return o}),a.d(e,"c",function(){return r}),a.d(e,"d",function(){return c}),a.d(e,"a",function(){return u});var i=a("b775"),s=a("2435"),l="/apis";function n(t){return Object(i["a"])({url:l,method:"GET",params:t})}function o(){return new Promise(function(t,e){var a=[],i="",l=s["c"];function o(s){n(s).then(function(e){e=e||[];var s=e.length;if(s>0){if(a=a.concat(e),i=e[s-1]||{},i.id){var n={after:i.id,limit:l};o(n)}}else t(a)}).catch(function(){e()})}var r={after:"",limit:l};o(r)})}function r(t){return Object(i["a"])({url:l+"/"+t,method:"GET"})}function c(t){return Object(i["a"])({url:l,method:"PUT",data:t})}function u(t){return Object(i["a"])({url:l+"/"+t,method:"DELETE"})}},5521:function(t,e,a){"use strict";var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"app-container"},[a("el-steps",{attrs:{active:t.step,"finish-status":"success"}},[a("el-step",[a("div",{staticClass:"step-item",attrs:{slot:"title"},on:{click:function(e){return t.handleToStep(0)}},slot:"title"},[t._v("基础信息")])]),t._v(" "),a("el-step",[a("div",{staticClass:"step-item",attrs:{slot:"title"},on:{click:function(e){return t.handleToStep(1)}},slot:"title"},[t._v("转发接口")])]),t._v(" "),a("el-step",[a("div",{staticClass:"step-item",attrs:{slot:"title"},on:{click:function(e){return t.handleToStep(2)}},slot:"title"},[t._v("服务保护")])]),t._v(" "),a("el-step",[a("div",{staticClass:"step-item",attrs:{slot:"title"},on:{click:function(e){return t.handleToStep(3)}},slot:"title"},[t._v("其他信息")])])],1),t._v(" "),a("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}]},[a("step-first",{directives:[{name:"show",rawName:"v-show",value:t.isFirstStep,expression:"isFirstStep"}],attrs:{"edit-item":t.stepFirstData,"do-validate":t.validateStepFirst},on:{"update:editItem":function(e){t.stepFirstData=e},"update:edit-item":function(e){t.stepFirstData=e},"update:doValidate":function(e){t.validateStepFirst=e},"update:do-validate":function(e){t.validateStepFirst=e},submitFormStep:t.handleSubmitFormStepFirst}}),t._v(" "),a("step-next",{directives:[{name:"show",rawName:"v-show",value:t.isNextStep,expression:"isNextStep"}],attrs:{"edit-item":t.stepNextData,"do-validate":t.validateStepNext},on:{"update:editItem":function(e){t.stepNextData=e},"update:edit-item":function(e){t.stepNextData=e},"update:doValidate":function(e){t.validateStepNext=e},"update:do-validate":function(e){t.validateStepNext=e},submitFormStep:t.handleSubmitFormStepNext}}),t._v(" "),a("step-next-next",{directives:[{name:"show",rawName:"v-show",value:t.isNextNextStep,expression:"isNextNextStep"}],attrs:{"edit-item":t.stepNextNextData,"do-validate":t.validateStepNextNext},on:{"update:editItem":function(e){t.stepNextNextData=e},"update:edit-item":function(e){t.stepNextNextData=e},"update:doValidate":function(e){t.validateStepNextNext=e},"update:do-validate":function(e){t.validateStepNextNext=e},submitFormStep:t.handleSubmitFormStepNextNext}}),t._v(" "),a("step-last",{directives:[{name:"show",rawName:"v-show",value:t.isLastStep,expression:"isLastStep"}],attrs:{"edit-item":t.stepLastData,"do-validate":t.validateStepLast},on:{"update:editItem":function(e){t.stepLastData=e},"update:edit-item":function(e){t.stepLastData=e},"update:doValidate":function(e){t.validateStepLast=e},"update:do-validate":function(e){t.validateStepLast=e},submitFormStep:t.handleSubmitFormStepLast}})],1),t._v(" "),a("div",{staticClass:"footer"},[a("div",{staticClass:"btn-group1"},[a("el-button",{attrs:{size:"mini"},on:{click:t.goList}},[t._v("返回")])],1),t._v(" "),a("div",{staticClass:"btn-group"},[a("el-button",{staticClass:"btn",staticStyle:{"margin-left":"180px"},attrs:{disabled:t.isFirstStep,type:"primary",icon:"el-icon-arrow-left",size:"mini"},on:{click:t.preStep}},[t._v("\n        上一步\n      ")]),t._v(" "),t.isLastStep?[t.isCreate?a("el-button",{attrs:{type:"primary",icon:"el-icon-check",size:"mini"},on:{click:function(e){return t.createItem("dataForm")}}},[t._v("提交\n        ")]):t.isUpdate?a("el-button",{attrs:{type:"primary",icon:"el-icon-check",size:"mini"},on:{click:function(e){return t.updateItem("dataForm")}}},[t._v("提交\n        ")]):t._e()]:[a("el-button",{staticClass:"btn",attrs:{type:"primary",icon:"el-icon-arrow-right",size:"mini"},on:{click:t.nextStep}},[t._v("下一步\n        ")])]],2)])],1)},s=[],l=(a("a481"),a("2435")),n=a("ed08"),o=a("4ec3"),r=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"app-container"},[a("el-form",{ref:"dataForm",attrs:{rules:t.rules,model:t.tempItem,"label-width":"180px"}},[a("el-form-item",{attrs:{label:"名称(Name)",prop:"name"}},[a("el-input",{staticStyle:{width:"200px"},model:{value:t.tempItem.name,callback:function(e){t.$set(t.tempItem,"name","string"===typeof e?e.trim():e)},expression:"tempItem.name"}})],1),t._v(" "),a("el-form-item",{attrs:{label:"匹配规则(MatchRule)"}},[a("el-select",{staticStyle:{width:"200px"},attrs:{placeholder:"匹配规则"},model:{value:t.tempItem.matchRule,callback:function(e){t.$set(t.tempItem,"matchRule",e)},expression:"tempItem.matchRule"}},t._l(t.matchRuleConstant,function(t){return a("el-option",{key:t.value,attrs:{value:t.value,label:t.title}})}),1),t._v(" "),a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",placement:"top-start"}},[a("div",{attrs:{slot:"content"},slot:"content"},[t._v("\n          matchDefault 匹配规则 Domain || (URLPattern && Method) "),a("br"),t._v("\n          matchAll 匹配规则 Domain && URLPattern && Method "),a("br"),t._v("\n          matchAny 匹配规则 Domain || URLPattern || Method\n        ")]),t._v(" "),a("i",{staticClass:"el-icon-info",staticStyle:{"margin-left":"10px",color:"#909399"}})])],1),t._v(" "),a("el-form-item",{attrs:{label:"域名(Domain)"}},[a("el-input",{staticStyle:{width:"450px"},attrs:{placeholder:"当原始请求的host等于该值，则认为匹配了当前的API"},model:{value:t.tempItem.domain,callback:function(e){t.$set(t.tempItem,"domain","string"===typeof e?e.trim():e)},expression:"tempItem.domain"}}),t._v(" "),a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",placement:"top-start"}},[a("div",{attrs:{slot:"content"},slot:"content"},[t._v("当原始请求的host等于该值，则认为匹配了当前的API，同时忽略URLPattern和Method。")]),t._v(" "),a("i",{staticClass:"el-icon-info",staticStyle:{"margin-left":"10px",color:"#909399"}})])],1),t._v(" "),a("el-form-item",{attrs:{label:"URL匹配模式(urlPattern)"}},[a("el-input",{staticStyle:{width:"450px"},attrs:{"auto-complete":"off",placeholder:"请输入接口URL匹配模式，正则表达式，如：^/api/users/(\\\\d+)$"},model:{value:t.tempItem.urlPattern,callback:function(e){t.$set(t.tempItem,"urlPattern","string"===typeof e?e.trim():e)},expression:"tempItem.urlPattern"}}),t._v(" "),a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",placement:"top-start"}},[a("div",{attrs:{slot:"content"},slot:"content"},[t._v("Gateway使用该字段来匹配原始请求的URL。"),a("br"),t._v("该字段必须和Method配合使用，同时满足才算这个请求匹配了这个API。")]),t._v(" "),a("i",{staticClass:"el-icon-info",staticStyle:{"margin-left":"10px",color:"#909399"}})])],1),t._v(" "),a("el-form-item",{attrs:{label:"接口请求类型(Method)"}},[a("el-select",{staticStyle:{width:"200px"},attrs:{placeholder:"接口请求类型"},model:{value:t.tempItem.method,callback:function(e){t.$set(t.tempItem,"method",e)},expression:"tempItem.method"}},t._l(t.methodsConstant,function(t){return a("el-option",{key:t.value,attrs:{value:t.value,label:t.title}})}),1),t._v(" "),a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",placement:"top-start"}},[a("div",{attrs:{slot:"content"},slot:"content"},[t._v("匹配请求的HTTP Method字段 "),a("br"),t._v(" * 匹配所有的HTTP Method（GET,PUT,POST,DELETE）。"),a("br"),t._v("该字段必须和URLPattern配合使用，同时满足才算这个请求匹配了这个API。\n        ")]),t._v(" "),a("i",{staticClass:"el-icon-info",staticStyle:{"margin-left":"10px",color:"#909399"}})])],1),t._v(" "),a("el-form-item",{attrs:{label:"匹配优先级(Position)"}},[a("el-input-number",{attrs:{min:0,max:100,label:"匹配优先级"},model:{value:t.tempItem.position,callback:function(e){t.$set(t.tempItem,"position",e)},expression:"tempItem.position"}}),t._v(" "),a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(e){t.dialogVisible=!0}}},[t._v("查看优先级排序")]),t._v(" "),a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",placement:"top-start"}},[a("div",{attrs:{slot:"content"},slot:"content"},[t._v("API匹配时按该值的升序匹配，即值越小优先级越高。默认值为0。")]),t._v(" "),a("i",{staticClass:"el-icon-info",staticStyle:{"margin-left":"10px",color:"#909399"}})])],1),t._v(" "),a("el-form-item",{attrs:{label:"是否生效(Status)"}},[a("el-switch",{attrs:{"active-color":"#13ce66","inactive-color":"#f1f1f1"},model:{value:t.tempItem.status,callback:function(e){t.$set(t.tempItem,"status",e)},expression:"tempItem.status"}}),t._v(" "),a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",placement:"top-start"}},[a("div",{attrs:{slot:"content"},slot:"content"},[t._v("只有开关开着，API 才能生效。")]),t._v(" "),a("i",{staticClass:"el-icon-info",staticStyle:{"margin-left":"10px",color:"#909399"}})])],1)],1),t._v(" "),a("el-dialog",{attrs:{title:"提示",visible:t.dialogVisible,width:"60%"},on:{"update:visible":function(e){t.dialogVisible=e}}},[a("el-table",{staticStyle:{width:"100%"},attrs:{border:"",fit:"",data:t.apiList,height:"400"}},[a("el-table-column",{attrs:{align:"center",label:"序号",width:"65"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("span",[t._v(t._s(e.$index+1))])]}}])}),t._v(" "),a("el-table-column",{attrs:{label:"名称"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("span",[t._v(t._s(e.row.name))])]}}])}),t._v(" "),a("el-table-column",{attrs:{label:"匹配规则"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("span",[t._v(t._s(t._f("matchRuleFilter")(e.row.matchRule)))])]}}])}),t._v(" "),a("el-table-column",{attrs:{label:"域名(Domain)"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("span",[t._v(t._s(e.row.domain))])]}}])}),t._v(" "),a("el-table-column",{attrs:{label:"URL匹配模式"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("span",[t._v(t._s(e.row.urlPattern))])]}}])}),t._v(" "),a("el-table-column",{attrs:{label:"接口请求类型"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("span",[t._v(t._s(e.row.method))])]}}])}),t._v(" "),a("el-table-column",{attrs:{label:"优先级"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("span",[t._v(t._s(e.row.position))])]}}])})],1),t._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(e){t.dialogVisible=!1}}},[t._v("关闭")])],1)],1)],1)},c=[],u=a("9b22"),p=a.n(u),d={watch:{doValidate:function(t,e){t&&this.submitForm()}},methods:{_showMessage:function(t){this.$message({type:"warning",message:t})}}},m={name:"StepFirst",mixins:[d],props:{editItem:{type:Object},doValidate:{type:Boolean}},data:function(){return{tempItem:{name:void 0,urlPattern:void 0,method:"*",domain:"",status:!0,position:0,matchRule:l["m"].matchDefault},methodsConstant:l["n"],matchRuleConstant:l["k"],rules:{name:[{required:!0,message:"请填写接口名称",trigger:"change"}]},apiList:[],dialogVisible:!1,apiListLoading:!0}},watch:{editItem:function(t,e){this.tempItem=Object(n["d"])(this.tempItem,Object(n["a"])(t)),this.loading=!1}},created:function(){this.init()},methods:{init:function(){var t=this;this.apiListLoading=!0,o["b"]().then(function(e){e=e||[],t.apiListLoading=!1,t.apiList=p()(e,"position")}).catch(function(){t.apiListLoading=!1})},submitForm:function(){var t=this;this.$refs["dataForm"].validate(function(e){var a=e;a&&(a=t._validateForm()),t.$emit("submitFormStep",!a,t.tempItem)})},clearValidate:function(){this.$refs["dataForm"].clearValidate()},_validateForm:function(){var t=!0;return this.tempItem.matchRule===l["m"].matchDefault?this.tempItem.domain||this.tempItem.urlPattern||(t=!1,this._showMessage("matchDefault 匹配规则 Domain || (URLPattern && Method)")):this.tempItem.matchRule===l["m"].matchAll&&(this.tempItem.domain&&this.tempItem.urlPattern||(t=!1,this._showMessage("matchAll 匹配规则 Domain && URLPattern && Method"))),t}}},h=m,f=a("2877"),v=Object(f["a"])(h,r,c,!1,null,"202dc53e",null),x=v.exports,b=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"app-container"},[t._l(t.tempItem.nodes,function(e,i){return a("div",{staticClass:"grid-content el-margin-bottom"},[a("el-card",{staticClass:"box-card"},[a("div",{staticClass:"title_t"},[t._v("接口 "+t._s(i+1)+"\n                "),a("a",{staticStyle:{float:"right","font-size":"12px",color:"#999999",cursor:"pointer"},on:{click:function(e){return t.removeNode(i)}}},[t._v("移除节点")])]),t._v(" "),a("el-form",{attrs:{"label-width":"120px"}},[a("el-form-item",{staticClass:"inline-item is-required",attrs:{label:"集群:"}},[a("el-select",{staticStyle:{width:"230px"},model:{value:e.clusterID,callback:function(a){t.$set(e,"clusterID",t._n(a))},expression:"item.clusterID"}},t._l(t.clusterList,function(t,e){return a("el-option",{key:t.id,attrs:{label:t.name,value:t.id}})}),1)],1),t._v(" "),a("el-form-item",{staticClass:"inline-item",attrs:{label:"写超时:"}},[a("div",[a("el-select",{staticStyle:{width:"100px"},attrs:{placeholder:"请选择"},model:{value:e.writeTimeoutType,callback:function(a){t.$set(e,"writeTimeoutType",a)},expression:"item.writeTimeoutType"}},t._l(t.timeTypeDefaultConstant,function(t){return a("el-option",{key:t.value,attrs:{value:t.value,label:t.title}})}),1),t._v(" "),a("el-input",{staticStyle:{width:"130px"},attrs:{placeholder:"",disabled:-1==e.writeTimeoutType},model:{value:e.writeTimeout,callback:function(a){t.$set(e,"writeTimeout",t._n(a))},expression:"item.writeTimeout"}})],1)]),t._v(" "),a("el-form-item",{staticClass:"inline-item",attrs:{label:"读超时:"}},[a("div",[a("el-select",{staticStyle:{width:"100px"},attrs:{placeholder:"请选择"},model:{value:e.readTimeoutType,callback:function(a){t.$set(e,"readTimeoutType",a)},expression:"item.readTimeoutType"}},t._l(t.timeTypeDefaultConstant,function(t){return a("el-option",{key:t.value,attrs:{value:t.value,label:t.title}})}),1),t._v(" "),a("el-input",{staticStyle:{width:"130px"},attrs:{placeholder:"",disabled:-1==e.readTimeoutType},model:{value:e.readTimeout,callback:function(a){t.$set(e,"readTimeout",t._n(a))},expression:"item.readTimeout"}})],1)]),t._v(" "),a("el-form-item",{staticClass:"inline-item",attrs:{label:"匹配优先级:"}},[a("el-input",{staticStyle:{width:"230px"},attrs:{placeholder:"例如:0"},model:{value:e.batchIndex,callback:function(a){t.$set(e,"batchIndex",t._n(a))},expression:"item.batchIndex"}})],1),t._v(" "),a("el-form-item",{staticClass:"inline-item",attrs:{label:"节点标示名:"}},[a("el-input",{staticStyle:{width:"230px"},attrs:{placeholder:"例如：user"},model:{value:e.attrName,callback:function(a){t.$set(e,"attrName","string"===typeof a?a.trim():a)},expression:"item.attrName"}})],1),t._v(" "),a("el-form-item",{staticClass:"inline-item",attrs:{label:"url重写规则:"}},[a("el-input",{staticStyle:{width:"230px"},attrs:{placeholder:"例如：/users?id=$1"},model:{value:e.urlRewrite,callback:function(a){t.$set(e,"urlRewrite","string"===typeof a?a.trim():a)},expression:"item.urlRewrite"}})],1),t._v(" "),a("el-form-item",{staticClass:"inline-item",attrs:{label:"host类型:"}},[a("div",[a("el-select",{staticStyle:{width:"150px"},attrs:{placeholder:"请选择"},model:{value:e.hostType,callback:function(a){t.$set(e,"hostType",a)},expression:"item.hostType"}},t._l(t.hostTypeConstant,function(t){return a("el-option",{key:t.value,attrs:{value:t.value,label:t.title}})}),1),t._v(" "),a("el-input",{directives:[{name:"show",rawName:"v-show",value:2===e.hostType,expression:"item.hostType === 2"}],staticStyle:{width:"200px"},attrs:{placeholder:""},model:{value:e.custemHost,callback:function(a){t.$set(e,"custemHost",a)},expression:"item.custemHost"}})],1)]),t._v(" "),a("el-form-item",{staticClass:"form-item-block",attrs:{label:"http默认值:"}},[a("div",{directives:[{name:"show",rawName:"v-show",value:e.needHttpDefault,expression:"item.needHttpDefault"}]},[a("el-row",{attrs:{gutter:10}},[a("el-col",{attrs:{span:6}},[a("label",{attrs:{for:""}},[t._v("是否强制启用默认值：\n                                    "),a("el-switch",{attrs:{"active-color":"#13ce66","inactive-color":"#f1f1f1"},model:{value:e.useDefault,callback:function(a){t.$set(e,"useDefault",a)},expression:"item.useDefault"}})],1)]),t._v(" "),a("el-col",{attrs:{span:6}},[a("label",{attrs:{for:""}},[a("span",{staticClass:"red-icon"},[t._v("*")]),t._v("状态码：\n                                    "),a("el-input",{staticStyle:{width:"65%"},attrs:{placeholder:"200，404，500"},model:{value:e.defaultValue.code,callback:function(a){t.$set(e.defaultValue,"code",t._n(a))},expression:"item.defaultValue.code"}})],1)]),t._v(" "),a("el-col",{attrs:{span:10}},[a("label",{attrs:{for:""}},[a("span",{staticClass:"red-icon"},[t._v("*")]),t._v("body 内容：\n                                    "),a("el-input",{staticStyle:{width:"65%"},attrs:{placeholder:"body 内容"},model:{value:e.defaultValue.body,callback:function(a){t.$set(e.defaultValue,"body",a)},expression:"item.defaultValue.body"}})],1)])],1),t._v(" "),a("el-row",{staticClass:"el-margin-top"},[a("el-col",{staticStyle:{"padding-right":"8px","text-align":"right"},attrs:{span:3}},[a("label",{attrs:{for:""}},[t._v("head头部:")])]),t._v(" "),a("el-col",{attrs:{span:20}},[t._l(e.defaultValue.headers,function(i,s){return[a("el-row",{staticClass:"el-margin-bottom"},[a("el-col",{attrs:{span:8}},[a("el-input",{attrs:{placeholder:"键"},model:{value:i.name,callback:function(e){t.$set(i,"name","string"===typeof e?e.trim():e)},expression:"head.name"}})],1),t._v(" "),a("el-col",{staticStyle:{"text-align":"center"},attrs:{span:1}},[t._v("=")]),t._v(" "),a("el-col",{attrs:{span:8}},[a("el-input",{attrs:{placeholder:"值"},model:{value:i.value,callback:function(e){t.$set(i,"value",e)},expression:"head.value"}})],1),t._v(" "),0===s?a("el-col",{staticStyle:{"text-align":"center"},attrs:{span:1}},[a("span",{staticClass:"el-icon-circle-plus-outline",staticStyle:{cursor:"pointer"},attrs:{title:"添加"},on:{click:function(a){return t.addNodeDefaultValueItem(e,"head")}}})]):t._e(),t._v(" "),s>0?a("el-col",{staticStyle:{"text-align":"center"},attrs:{span:1}},[a("span",{staticClass:"el-icon-remove-outline",staticStyle:{cursor:"pointer"},attrs:{title:"删除"},on:{click:function(a){return t.removeNodeDefaultValueItem(e,"head",s)}}})]):t._e()],1)]})],2)],1),t._v(" "),a("el-row",{staticClass:"el-margin-top"},[a("el-col",{staticStyle:{"padding-right":"8px","text-align":"right"},attrs:{span:3}},[a("label",{attrs:{for:""}},[t._v("cookie内容:")])]),t._v(" "),a("el-col",{attrs:{span:20}},[t._l(e.defaultValue.cookies,function(i,s){return[a("el-row",{staticClass:"el-margin-bottom"},[a("el-col",{attrs:{span:8}},[a("el-input",{attrs:{placeholder:"键"},model:{value:i.name,callback:function(e){t.$set(i,"name","string"===typeof e?e.trim():e)},expression:"cookie.name"}})],1),t._v(" "),a("el-col",{staticStyle:{"text-align":"center"},attrs:{span:1}},[t._v("=")]),t._v(" "),a("el-col",{attrs:{span:8}},[a("el-input",{attrs:{placeholder:"值"},model:{value:i.value,callback:function(e){t.$set(i,"value",e)},expression:"cookie.value"}})],1),t._v(" "),0===s?a("el-col",{staticStyle:{"text-align":"center"},attrs:{span:1}},[a("span",{staticClass:"el-icon-circle-plus-outline",staticStyle:{cursor:"pointer"},attrs:{title:"添加"},on:{click:function(a){return t.addNodeDefaultValueItem(e,"cookie")}}})]):t._e(),t._v(" "),s>0?a("el-col",{staticStyle:{"text-align":"center"},attrs:{span:1}},[a("span",{staticClass:"el-icon-remove-outline",staticStyle:{cursor:"pointer"},attrs:{title:"删除"},on:{click:function(a){return t.removeNodeDefaultValueItem(e,"cookie",s)}}})]):t._e()],1)]})],2)],1),t._v(" "),a("el-button",{attrs:{type:"text"},on:{click:function(t){e.needHttpDefault=!1}}},[t._v("移除Http默认值")])],1),t._v(" "),a("el-button",{directives:[{name:"show",rawName:"v-show",value:!e.needHttpDefault,expression:"!item.needHttpDefault"}],attrs:{type:"text"},on:{click:function(t){e.needHttpDefault=!0}}},[t._v("\n                        添加Http默认值\n                    ")])],1),t._v(" "),a("el-form-item",{staticClass:"form-item-block",attrs:{label:"重试策略:"}},[a("div",{directives:[{name:"show",rawName:"v-show",value:e.needRetryStrategy,expression:"item.needRetryStrategy"}]},[a("el-row",{staticStyle:{overflow:"hidden"},attrs:{gutter:10}},[a("el-col",{attrs:{span:7}},[a("label",{attrs:{for:""}},[a("span",{staticClass:"red-icon"},[t._v("*")]),t._v("重试间隔时间:\n                                    "),a("el-input",{staticStyle:{width:"60%"},attrs:{placeholder:"重试间隔时间"},model:{value:e.retryStrategy.interval,callback:function(a){t.$set(e.retryStrategy,"interval",t._n(a))},expression:"item.retryStrategy.interval"}}),t._v(" "),a("span",[t._v("ms")])],1)]),t._v(" "),a("el-col",{attrs:{span:7}},[a("label",{attrs:{for:""}},[a("span",{staticClass:"red-icon"},[t._v("*")]),t._v("最多重试次数:\n                                    "),a("el-input",{staticStyle:{width:"60%"},attrs:{placeholder:"最多重试次数"},model:{value:e.retryStrategy.maxTimes,callback:function(a){t.$set(e.retryStrategy,"maxTimes",t._n(a))},expression:"item.retryStrategy.maxTimes"}})],1)])],1),t._v(" "),a("el-row",{staticClass:"el-margin-top",attrs:{gutter:10}},[a("el-col",{attrs:{span:11}},[a("label",{staticStyle:{"margin-left":"8px"},attrs:{for:""}},[t._v("处理的错误码:\n                                    "),a("el-input",{staticStyle:{width:"70%"},attrs:{placeholder:"多个的情况用逗号分隔"},model:{value:e.retryStrategy.codesStr,callback:function(a){t.$set(e.retryStrategy,"codesStr",a)},expression:"item.retryStrategy.codesStr"}}),t._v(" "),a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",placement:"top-start"}},[a("div",{attrs:{slot:"content"},slot:"content"},[t._v("存在多个code 的情况，用英文逗号“,”分隔")]),t._v(" "),a("i",{staticClass:"el-icon-info",staticStyle:{"margin-left":"10px",color:"#909399"}})])],1)])],1),t._v(" "),a("el-button",{attrs:{type:"text"},on:{click:function(t){e.needRetryStrategy=!1}}},[t._v("移除重试策略")])],1),t._v(" "),a("el-button",{directives:[{name:"show",rawName:"v-show",value:!e.needRetryStrategy,expression:"!item.needRetryStrategy"}],attrs:{type:"text"},on:{click:function(t){e.needRetryStrategy=!0}}},[t._v("\n                        添加重试策略\n                    ")])],1),t._v(" "),a("el-form-item",{staticClass:"form-item-block",attrs:{label:"数据缓存:"}},[a("div",{directives:[{name:"show",rawName:"v-show",value:e.needCache,expression:"item.needCache"}]},[a("el-row",{staticStyle:{overflow:"hidden"},attrs:{gutter:10}},[a("el-col",{staticStyle:{"text-align":"right"},attrs:{span:3}},[a("label",{attrs:{for:""}},[a("span",{staticClass:"red-icon"},[t._v("*")]),t._v("过期时间:")])]),t._v(" "),a("el-col",{attrs:{span:10}},[a("el-input",{staticStyle:{width:"70%"},attrs:{placeholder:"请填写过期时间"},model:{value:e.cache.deadline,callback:function(a){t.$set(e.cache,"deadline",t._n(a))},expression:"item.cache.deadline"}},[a("el-select",{staticStyle:{width:"100px"},attrs:{slot:"prepend",placeholder:"请选择"},slot:"prepend",model:{value:e.cache.deadlineType,callback:function(a){t.$set(e.cache,"deadlineType",a)},expression:"item.cache.deadlineType"}},t._l(t.timeTypeConstant,function(t){return a("el-option",{key:t.value,attrs:{value:t.value,label:t.title}})}),1)],1)],1)],1),t._v(" "),a("el-row",{staticStyle:{"margin-top":"10px"},attrs:{gutter:10}},[a("el-col",{staticStyle:{"text-align":"right"},attrs:{span:3}},[a("label",{attrs:{for:""}},[a("span",{staticClass:"red-icon"},[t._v("*")]),t._v("关键词:")])]),t._v(" "),a("el-col",{attrs:{span:21}},[t._l(e.cache.keys,function(i,s){return[a("el-row",{staticClass:"el-margin-bottom",attrs:{gutter:10}},[a("el-col",{staticStyle:{"text-align":"center"},attrs:{span:6}},[a("el-select",{attrs:{placeholder:"请选择参数数据源"},model:{value:i.source,callback:function(e){t.$set(i,"source",e)},expression:"key.source"}},t._l(t.sourceConstant,function(t,e){return a("el-option",{key:t.value,attrs:{label:t.title,value:t.value}})}),1)],1),t._v(" "),5!==i.source?a("el-col",{attrs:{span:6}},[a("el-input",{attrs:{placeholder:"关键词"},model:{value:i.name,callback:function(e){t.$set(i,"name",e)},expression:"key.name"}})],1):a("el-col",{attrs:{span:6}},[a("el-input",{staticStyle:{width:"85%"},attrs:{placeholder:"路径index"},model:{value:i.index,callback:function(e){t.$set(i,"index",t._n(e))},expression:"key.index"}}),t._v(" "),a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",placement:"top-start"}},[a("div",{attrs:{slot:"content"},slot:"content"},[t._v("\n                                                    http://example.com/path1/path2/path3?xxx=aa,填写1匹配path1，2匹配path2，3匹配path3\n                                                ")]),t._v(" "),a("i",{staticClass:"el-icon-info",staticStyle:{"margin-left":"10px",color:"#909399"}})])],1),t._v(" "),0===s?a("el-col",{staticStyle:{"text-align":"center"},attrs:{span:1}},[a("span",{staticClass:"el-icon-circle-plus-outline",staticStyle:{cursor:"pointer"},attrs:{title:"添加"},on:{click:function(a){return t.addNodeCacheKeyItem(e.cache)}}})]):t._e(),t._v(" "),s>0?a("el-col",{staticStyle:{"text-align":"center"},attrs:{span:1}},[a("span",{staticClass:"el-icon-remove-outline",staticStyle:{cursor:"pointer"},attrs:{title:"删除"},on:{click:function(a){return t.removeNodeCacheKeyItem(e.cache,s)}}})]):t._e()],1)]})],2)],1),t._v(" "),a("el-row",{staticStyle:{"margin-top":"10px"},attrs:{gutter:10}},[a("el-col",{staticStyle:{"text-align":"right"},attrs:{span:3}},[a("label",{attrs:{for:""}},[a("span",{staticClass:"red-icon"},[t._v("*")]),t._v("匹配条件:")])]),t._v(" "),a("el-col",{attrs:{span:21}},[t._l(e.cache.conditions,function(i,s){return[a("el-row",{staticClass:"el-margin-bottom",attrs:{gutter:10}},[a("el-col",{attrs:{span:5}},[a("el-select",{attrs:{placeholder:"请选择参数数据源"},model:{value:i.parameter.source,callback:function(e){t.$set(i.parameter,"source",e)},expression:"condition.parameter.source"}},t._l(t.sourceConstant,function(t,e){return a("el-option",{key:t.value,attrs:{label:t.title,value:t.value}})}),1)],1),t._v(" "),5!==i.parameter.source?a("el-col",{attrs:{span:5}},[a("el-input",{attrs:{placeholder:"关键词"},model:{value:i.parameter.name,callback:function(e){t.$set(i.parameter,"name",e)},expression:"condition.parameter.name"}})],1):a("el-col",{attrs:{span:5}},[a("el-input",{staticStyle:{width:"80%"},attrs:{placeholder:"路径index"},model:{value:i.parameter.index,callback:function(e){t.$set(i.parameter,"index",t._n(e))},expression:"condition.parameter.index"}}),t._v(" "),a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",placement:"top-start"}},[a("div",{attrs:{slot:"content"},slot:"content"},[t._v("\n                                                    http://example.com/path1/path2/path3?xxx=aa,填写1匹配path1，2匹配path2，3匹配path3\n                                                ")]),t._v(" "),a("i",{staticClass:"el-icon-info",staticStyle:{"margin-left":"10px",color:"#909399"}})])],1),t._v(" "),a("el-col",{attrs:{span:4}},[a("el-select",{attrs:{placeholder:"操作符"},model:{value:i.cmp,callback:function(e){t.$set(i,"cmp",e)},expression:"condition.cmp"}},t._l(t.cmpConstant,function(t,e){return a("el-option",{key:t.value,attrs:{label:t.title,value:t.value}})}),1)],1),t._v(" "),a("el-col",{attrs:{span:5}},[a("el-input",{attrs:{placeholder:"expect"},model:{value:i.expect,callback:function(e){t.$set(i,"expect",e)},expression:"condition.expect"}})],1),t._v(" "),0===s?a("el-col",{staticStyle:{"text-align":"center"},attrs:{span:1}},[a("span",{staticClass:"el-icon-circle-plus-outline",staticStyle:{cursor:"pointer"},attrs:{title:"添加"},on:{click:function(a){return t.addNodeCacheConditionItem(e.cache)}}})]):t._e(),t._v(" "),s>0?a("el-col",{staticStyle:{"text-align":"center"},attrs:{span:1}},[a("span",{staticClass:"el-icon-remove-outline",staticStyle:{cursor:"pointer"},attrs:{title:"删除"},on:{click:function(a){return t.removeNodeCacheConditionItem(e.cache,s)}}})]):t._e()],1)]})],2)],1),t._v(" "),a("el-button",{attrs:{type:"text"},on:{click:function(t){e.needCache=!1}}},[t._v("移除数据缓存")])],1),t._v(" "),a("el-button",{directives:[{name:"show",rawName:"v-show",value:!e.needCache,expression:"!item.needCache"}],attrs:{type:"text"},on:{click:function(t){e.needCache=!0}}},[t._v("添加数据缓存\n                    ")])],1),t._v(" "),a("el-form-item",{staticClass:"form-item-block",attrs:{label:"校验规则:"}},[a("div",{directives:[{name:"show",rawName:"v-show",value:e.needValidations,expression:"item.needValidations"}]},[t._l(e.validations,function(i,s){return[a("div",{staticStyle:{overflow:"hidden"}},[a("el-row",{attrs:{gutter:10}},[a("el-col",{attrs:{span:5}},[a("el-select",{attrs:{placeholder:"请选择参数数据源"},model:{value:i.parameter.source,callback:function(e){t.$set(i.parameter,"source",e)},expression:"validation.parameter.source"}},t._l(t.sourceConstant,function(t,e){return a("el-option",{key:t.value,attrs:{label:t.title,value:t.value}})}),1)],1),t._v(" "),5!==i.parameter.source?a("el-col",{attrs:{span:5}},[a("el-input",{attrs:{placeholder:"关键词"},model:{value:i.parameter.name,callback:function(e){t.$set(i.parameter,"name",e)},expression:"validation.parameter.name"}})],1):a("el-col",{attrs:{span:5}},[a("el-input",{staticStyle:{width:"80%"},attrs:{placeholder:"路径index"},model:{value:i.parameter.index,callback:function(e){t.$set(i.parameter,"index",t._n(e))},expression:"validation.parameter.index"}}),t._v(" "),a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",placement:"top-start"}},[a("div",{attrs:{slot:"content"},slot:"content"},[t._v("\n                                                http://example.com/path1/path2/path3?xxx=aa,填写1匹配path1，2匹配path2，3匹配path3\n                                            ")]),t._v(" "),a("i",{staticClass:"el-icon-info",staticStyle:{"margin-left":"10px",color:"#909399"}})])],1),t._v(" "),i.rules&&i.rules.length>0?a("el-col",{attrs:{span:4}},[a("el-input",{attrs:{placeholder:"填写正则匹配规则"},model:{value:i.rules[0].expression,callback:function(e){t.$set(i.rules[0],"expression",e)},expression:"validation.rules[0].expression"}})],1):t._e(),t._v(" "),a("el-col",{attrs:{span:4}},[a("el-checkbox-group",{staticStyle:{color:"#666666",float:"left"},model:{value:i.required,callback:function(e){t.$set(i,"required",e)},expression:"validation.required"}},[a("el-checkbox",{attrs:{label:"是否必须",name:"type"}})],1)],1),t._v(" "),0===s?a("el-col",{staticStyle:{"text-align":"center"},attrs:{span:1}},[a("span",{staticClass:"el-icon-circle-plus-outline",staticStyle:{cursor:"pointer"},attrs:{title:"添加"},on:{click:function(a){return t.addNodeValidationItem(e.validations)}}})]):t._e(),t._v(" "),s>0?a("el-col",{staticStyle:{"text-align":"center"},attrs:{span:1}},[a("span",{staticClass:"el-icon-remove-outline",staticStyle:{cursor:"pointer"},attrs:{title:"删除"},on:{click:function(a){return t.removeNodeValidationItem(e.validations,s)}}})]):t._e()],1)],1)]}),t._v(" "),a("el-button",{attrs:{type:"text"},on:{click:function(t){e.needValidations=!1}}},[t._v("移除校验规则")])],2),t._v(" "),a("el-button",{directives:[{name:"show",rawName:"v-show",value:!e.needValidations,expression:"!item.needValidations"}],attrs:{type:"text"},on:{click:function(t){e.needValidations=!0}}},[t._v("\n                        添加校验规则\n                    ")])],1)],1)],1)],1)}),t._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:t.addNode}},[t._v("添加节点")])],2)},_=[],y=(a("28a5"),a("7f7f"),a("ac6a"),a("7ea2"));function g(){return{parameter:{name:"",source:"",index:0},required:!1,rules:[{ruleType:l["q"].ruleRegexp,expression:""}]}}function k(){return{name:"",source:"",index:0}}function S(){return{cmp:"",expect:"",parameter:{name:"",source:"",index:0}}}function w(){var t=g(),e={clusterID:"",urlRewrite:"",custemHost:"",hostType:l["g"].hostOrigin,attrName:"",useDefault:!1,batchIndex:void 0,writeTimeout:"",writeTimeoutType:l["y"].second,readTimeout:"",readTimeoutType:l["y"].second,validations:[t],cache:{keys:[k()],deadline:"",deadlineType:l["y"].second,conditions:[S()]},defaultValue:{code:200,body:"",headers:[{name:"",value:""}],cookies:[{name:"",value:""}]},retryStrategy:{interval:"",maxTimes:"",codes:[],codesStr:""},needValidations:!1,needCache:!1,needRetryStrategy:!1,needHttpDefault:!1};return e}var I={name:"stepNext",props:{editItem:{type:Object},doValidate:{type:Boolean}},data:function(){return{tempItem:{nodes:[]},sourceConstant:l["r"],cmpConstant:l["b"],timeTypeConstant:l["w"],timeTypeDefaultConstant:l["x"],hostTypeConstant:l["f"],rules:{},clusterList:[]}},mixins:[d],created:function(){this.init()},watch:{editItem:function(t,e){this._updateData(t)}},methods:{init:function(){var t=this;y["b"]().then(function(e){t.clusterList=e})},submitForm:function(){var t=this._formatFormData(),e=t.result,a=t.isError;this.$emit("submitFormStep",a,e)},_updateData:function(t){var e=t||{},a=[];e.nodes&&e.nodes.forEach(function(t){var e=Object(n["e"])(w(),Object(n["a"])(t));if(e.writeTimeout?(e.writeTimeout=Object(n["k"])(e.writeTimeout),e.writeTimeoutType=l["y"].second):(e.writeTimeoutType=l["y"].default,e.writeTimeout=void 0),e.readTimeout?(e.readTimeout=Object(n["k"])(e.readTimeout),e.readTimeoutType=l["y"].second):(e.readTimeoutType=l["y"].default,e.readTimeout=void 0),e.defaultValue&&e.defaultValue.code&&e.defaultValue.body&&(e.needHttpDefault=!0,e.defaultValue.body&&(e.defaultValue.body=Object(n["b"])(e.defaultValue.body))),e.retryStrategy&&e.retryStrategy.interval&&e.retryStrategy.maxTimes&&(e.needRetryStrategy=!0,e.retryStrategy.codesStr=e.retryStrategy.codes&&e.retryStrategy.codes.join(","),e.retryStrategy.intervalType=l["y"].second),e.cache&&e.cache.deadline&&(e.cache.deadline=Object(n["k"])(e.cache.deadline),e.cache.deadlineType=l["y"].second,e.needCache=!0),e.validations&&e.validations.length>0){var i=e.validations[0];if(i.parameter&&i.parameter.name&&(e.needValidations=!0),!i.rules||i.rules&&0===i.rules.length){i.rules=[];var s={ruleType:l["q"].ruleRegexp,expression:""};i.rules.push(s)}}a.push(e)}),this.tempItem.nodes=a},_formatFormData:function(){for(var t=Object(n["a"])(this.tempItem),e={nodes:[]},a=!1,i=0,s=t.nodes.length;i<s;i++){var o=t.nodes[i],r="接口".concat(i+1,": ");if(!o.clusterID){this._showMessage(r+"请选择集群"),a=!0;break}if(o.hostType===l["g"].hostCustom){if(!o.custemHost){this._showMessage(r+"请填写host类型hostCustom对应的host 值"),a=!0;break}}else delete o.custemHost;if(o.writeTimeoutType==l["y"].default?delete o.writeTimeout:o.writeTimeout=Object(n["j"])(o.writeTimeout,o.writeTimeoutType),delete o.writeTimeoutType,o.readTimeoutType==l["y"].default?delete o.readTimeout:o.readTimeout=Object(n["j"])(o.readTimeout,o.readTimeoutType),delete o.readTimeoutType,o.needHttpDefault){if(!o.defaultValue.code){this._showMessage(r+"请填写状态码"),a=!0;break}if(!o.defaultValue.body){this._showMessage(r+"请填写body内容"),a=!0;break}o.defaultValue.body&&(o.defaultValue.body=Object(n["c"])(o.defaultValue.body))}else delete o.defaultValue,o.useDefault=!1;if(o.needRetryStrategy){if(!o.retryStrategy.interval){this._showMessage(r+"请填写重试策略的重试间隔时间字段"),a=!0;break}if(!o.retryStrategy.maxTimes){this._showMessage(r+"请填写重试策略的最多重试次数字段"),a=!0;break}if(o.retryStrategy.codesStr){var c=o.retryStrategy.codesStr.split(",");o.retryStrategy.codes=c.map(function(t){return parseInt(t,10)}),0===o.retryStrategy.codes.length&&delete o.retryStrategy.codes,delete o.retryStrategy.codesStr}}else delete o.retryStrategy;if(o.needCache){if(!o.cache.deadline){this._showMessage(r+"请填写数据缓存的超时时间字段"),a=!0;break}o.cache.deadline=Object(n["j"])(o.cache.deadline,o.cache.deadlineType),delete o.cache.deadlineType,o.cache.keys&&o.cache.keys.length>0&&o.cache.keys.forEach(function(t){5===t.source?t.name="":t.index=0}),o.cache.conditions&&o.cache.conditions.length>0&&o.cache.conditions.forEach(function(t){5===t.parameter.source?t.parameter.name="":t.parameter.index=0})}else delete o.cache;o.needValidations?o.validations&&o.validations.length>0&&o.validations.forEach(function(t){5==t.parameter.source?t.parameter.name="":t.parameter.index=0}):delete o.validations,delete o.needValidations,delete o.needCache,delete o.needRetryStrategy,e.nodes.push(o)}return{isError:a,result:e}},addNodeDefaultValueItem:function(t,e){var a={name:"",value:""};"head"===e?t.defaultValue.headers.push(a):"cookie"===e&&t.defaultValue.cookies.push(a)},addNodeCacheKeyItem:function(t){var e=k();t.keys.push(e)},removeNodeCacheKeyItem:function(t,e){this.$confirm("是否确定移除?","移除操作",{confirmButtonText:"确定",confirmButtonClass:"el-button--danger",cancelButtonText:"取消",type:"warning"}).then(function(){t.keys.splice(e,1)}).catch(function(){})},addNodeCacheConditionItem:function(t){var e=S();t.conditions.push(e)},removeNodeCacheConditionItem:function(t,e){this.$confirm("是否确定移除?","移除操作",{confirmButtonText:"确定",confirmButtonClass:"el-button--danger",cancelButtonText:"取消",type:"warning"}).then(function(){t.conditions.splice(e,1)}).catch(function(){})},addNodeValidationItem:function(t){var e=g();t.push(e)},removeNodeValidationItem:function(t,e){this.$confirm("是否确定移除?","移除操作",{confirmButtonText:"确定",confirmButtonClass:"el-button--danger",cancelButtonText:"取消",type:"warning"}).then(function(){t.splice(e,1)}).catch(function(){})},addNode:function(){var t=w();this.tempItem.nodes.push(t)},removeNode:function(t){var e=this;this.$confirm("是否确定移除?","移除操作",{confirmButtonText:"确定",confirmButtonClass:"el-button--danger",cancelButtonText:"取消",type:"warning"}).then(function(){e.tempItem.nodes.splice(t,1)}).catch(function(){})},removeNodeDefaultValueItem:function(t,e,a){this.$confirm("是否确定移除?","移除操作",{confirmButtonText:"确定",confirmButtonClass:"el-button--danger",cancelButtonText:"取消",type:"warning"}).then(function(){"head"===e&&t.defaultValue.headers.splice(a,1),"cookie"===e&&t.defaultValue.cookies.splice(a,1)}).catch(function(){})},needNodeDefaultValueDeleteShow:function(t){return this.needDefaultValueDeleteShow(t)},needDefaultValueDeleteShow:function(t){return t=t||{},""!==t.name||""!==t.value},clearValidate:function(){}}},C=I,T=(a("58c8"),Object(f["a"])(C,b,_,!1,null,"7300c18d",null)),V=T.exports,N=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"app-container"},[a("el-form",{ref:"dataForm",attrs:{model:t.tempItem,"label-width":"150px"}},[a("el-form-item",{attrs:{label:"支持的最大QPS",prop:"maxQPS"}},[t.needMaxQPS?[a("div",[a("el-input",{staticStyle:{width:"200px"},attrs:{placeholder:"用于流控"},model:{value:t.tempItem.maxQPS,callback:function(e){t.$set(t.tempItem,"maxQPS",t._n(e))},expression:"tempItem.maxQPS"}})],1),t._v(" "),a("el-button",{attrs:{type:"text"},on:{click:function(e){t.needMaxQPS=!1}}},[t._v("移除支持的最大QPS")])]:[a("el-button",{attrs:{type:"text"},on:{click:function(e){t.needMaxQPS=!0}}},[t._v("添加支持的最大QPS")])]],2),t._v(" "),a("el-form-item",{staticStyle:{width:"800px"},attrs:{label:"熔断器设置"}},[a("el-row",[a("el-col",[a("el-button",{directives:[{name:"show",rawName:"v-show",value:!t.needCircuitBreaker,expression:"!needCircuitBreaker"}],attrs:{type:"text"},on:{click:function(e){t.needCircuitBreaker=!0}}},[t._v("添加熔断规则\n                    ")]),t._v(" "),a("el-card",{directives:[{name:"show",rawName:"v-show",value:t.needCircuitBreaker,expression:"needCircuitBreaker"}],staticClass:"box-card"},[a("div",{staticClass:"clearfix",staticStyle:{"line-height":"25px"},attrs:{slot:"header"},slot:"header"},[a("el-alert",{attrs:{closable:!1,title:"熔断器，设置后端Server的熔断规则。熔断器分为3个状态： Open、Half、Close",type:"warning"}})],1),t._v(" "),a("el-row",[a("el-col",{staticStyle:{"text-align":"right","padding-right":"8px"},attrs:{span:12}},[a("span",{staticClass:"red-icon"},[t._v("*")]),t._v("打开到半打开状态的时间间隔:\n                            ")]),t._v(" "),a("el-col",{attrs:{span:10}},[a("el-input",{attrs:{placeholder:"请填写"},model:{value:t.tempItem.circuitBreaker.closeTimeout,callback:function(e){t.$set(t.tempItem.circuitBreaker,"closeTimeout",t._n(e))},expression:"tempItem.circuitBreaker.closeTimeout"}},[a("el-select",{staticStyle:{width:"100px"},attrs:{slot:"prepend",placeholder:"请选择"},slot:"prepend",model:{value:t.tempItem.circuitBreaker.closeTimeoutType,callback:function(e){t.$set(t.tempItem.circuitBreaker,"closeTimeoutType",e)},expression:"tempItem.circuitBreaker.closeTimeoutType"}},t._l(t.timeTypeConstant,function(t){return a("el-option",{key:t.value,attrs:{value:t.value,label:t.title}})}),1)],1)],1)],1),t._v(" "),a("el-row",{staticClass:"el-margin-top"},[a("el-col",{staticStyle:{"text-align":"right","padding-right":"8px"},attrs:{span:12}},[a("span",{staticClass:"red-icon"},[t._v("*")]),t._v("半打开状态下限流百分比:\n                            ")]),t._v(" "),a("el-col",{attrs:{span:10}},[a("el-input",{attrs:{placeholder:"区间：1-100"},model:{value:t.tempItem.circuitBreaker.halfTrafficRate,callback:function(e){t.$set(t.tempItem.circuitBreaker,"halfTrafficRate",t._n(e))},expression:"tempItem.circuitBreaker.halfTrafficRate"}})],1)],1),t._v(" "),a("div",{staticClass:"form-item-block"},[a("el-row",{staticClass:"el-margin-top"},[a("el-col",{staticStyle:{"text-align":"right","padding-right":"8px"},attrs:{span:12}},[a("span",{staticClass:"red-icon"},[t._v("*")]),t._v("采集周期:\n                                ")]),t._v(" "),a("el-col",{attrs:{span:10}},[a("el-input",{attrs:{placeholder:"请填写"},model:{value:t.tempItem.circuitBreaker.rateCheckPeriod,callback:function(e){t.$set(t.tempItem.circuitBreaker,"rateCheckPeriod",t._n(e))},expression:"tempItem.circuitBreaker.rateCheckPeriod "}},[a("el-select",{staticStyle:{width:"100px"},attrs:{slot:"prepend",placeholder:"请选择"},slot:"prepend",model:{value:t.tempItem.circuitBreaker.rateCheckPeriodType,callback:function(e){t.$set(t.tempItem.circuitBreaker,"rateCheckPeriodType",e)},expression:"tempItem.circuitBreaker.rateCheckPeriodType"}},t._l(t.timeTypeConstant,function(t){return a("el-option",{key:t.value,attrs:{value:t.value,label:t.title}})}),1)],1)],1)],1),t._v(" "),a("el-row",{staticClass:"el-margin-top"},[a("el-col",{staticStyle:{"text-align":"right","padding-right":"8px"},attrs:{span:12}},[a("span",{staticClass:"red-icon"},[t._v("*")]),t._v("半打开状态转换到打开状态的错误百分比:\n                                ")]),t._v(" "),a("el-col",{attrs:{span:10}},[a("el-input",{attrs:{placeholder:"区间：1-100"},model:{value:t.tempItem.circuitBreaker.failureRateToClose,callback:function(e){t.$set(t.tempItem.circuitBreaker,"failureRateToClose",t._n(e))},expression:"tempItem.circuitBreaker.failureRateToClose"}})],1)],1),t._v(" "),a("el-row",{staticClass:"el-margin-top"},[a("el-col",{staticStyle:{"text-align":"right","padding-right":"8px"},attrs:{span:12}},[a("span",{staticClass:"red-icon"},[t._v("*")]),t._v("半打开状态到关闭的成功百分比:\n                                ")]),t._v(" "),a("el-col",{attrs:{span:10}},[a("el-input",{attrs:{placeholder:"区间：1-100"},model:{value:t.tempItem.circuitBreaker.succeedRateToOpen,callback:function(e){t.$set(t.tempItem.circuitBreaker,"succeedRateToOpen",t._n(e))},expression:"tempItem.circuitBreaker.succeedRateToOpen"}})],1)],1)],1)],1),t._v(" "),a("el-button",{directives:[{name:"show",rawName:"v-show",value:t.needCircuitBreaker,expression:"needCircuitBreaker"}],attrs:{type:"text"},on:{click:function(e){t.needCircuitBreaker=!1}}},[t._v("移除熔断规则\n                    ")])],1)],1)],1)],1)],1)},D=[];function B(){return{closeTimeout:0,closeTimeoutType:l["y"].second,rateCheckPeriod:0,rateCheckPeriodType:l["y"].second,halfTrafficRate:"",failureRateToClose:"",succeedRateToOpen:""}}var $={name:"StepNextNext",props:{editItem:{type:Object},doValidate:{type:Boolean}},data:function(){return{tempItem:{maxQPS:void 0,circuitBreaker:B()},needCircuitBreaker:!1,needMaxQPS:!1,timeTypeConstant:l["w"]}},watch:{editItem:function(t,e){this.tempItem=Object(n["e"])(this.tempItem,Object(n["a"])(t)),this.tempItem.maxQPS&&(this.needMaxQPS=!0),this.tempItem.circuitBreaker?(this.tempItem.circuitBreaker.closeTimeout&&this.tempItem.circuitBreaker.rateCheckPeriod&&(this.needCircuitBreaker=!0,this.tempItem.circuitBreaker.closeTimeout=Object(n["k"])(this.tempItem.circuitBreaker.closeTimeout),this.tempItem.circuitBreaker.rateCheckPeriod=Object(n["k"])(this.tempItem.circuitBreaker.rateCheckPeriod)),this.$set(this.tempItem.circuitBreaker,"closeTimeoutType",l["y"].second),this.$set(this.tempItem.circuitBreaker,"rateCheckPeriodType",l["y"].second)):this.tempItem.circuitBreaker=B()}},mixins:[d],methods:{submitForm:function(){var t=this._formatFormData(),e=t.result,a=t.isError;this.$emit("submitFormStep",a,e)},_formatFormData:function(){var t=Object(n["a"])(this.tempItem),e=!1;return this.needMaxQPS?t.maxQPS||(e=!0,this._showMessage("填写支持的最大QPS。")):t.maxQPS="",this.needCircuitBreaker?(t.circuitBreaker.closeTimeout?t.circuitBreaker.rateCheckPeriod?t.circuitBreaker.failureRateToClose?t.circuitBreaker.halfTrafficRate?t.circuitBreaker.succeedRateToOpen||(e=!0,this._showMessage("填写熔断规则的Half -> Open的成功百分比。")):(e=!0,this._showMessage("填写熔断规则的Half限流百分比。")):(e=!0,this._showMessage("填写熔断规则的Open -> Close的错误百分比。")):(e=!0,this._showMessage("填写熔断规则的熔断器检查周期。")):(e=!0,this._showMessage("填写熔断规则的关闭检查间隔时间。")),t.circuitBreaker.rateCheckPeriod=Object(n["j"])(t.circuitBreaker.rateCheckPeriod,t.circuitBreaker.rateCheckPeriodType),t.circuitBreaker.closeTimeout=Object(n["j"])(t.circuitBreaker.closeTimeout,t.circuitBreaker.closeTimeoutType)):t.circuitBreaker={},{isError:e,result:t}}}},P=$,O=(a("a273"),Object(f["a"])(P,N,D,!1,null,"12f7b1b2",null)),j=O.exports,F=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"app-container"},[a("el-form",{ref:"dataForm",attrs:{model:t.tempItem,"label-width":"180px"}},[a("el-form-item",{staticStyle:{width:"800px"},attrs:{label:"默认返回值(UseDefault)"}},[a("el-row",[a("el-col",[a("el-button",{directives:[{name:"show",rawName:"v-show",value:!t.needDefaultValue,expression:"!needDefaultValue"}],attrs:{type:"text"},on:{click:function(e){t.needDefaultValue=!0}}},[t._v("添加默认返回值\n                    ")]),t._v(" "),a("el-card",{directives:[{name:"show",rawName:"v-show",value:t.needDefaultValue,expression:"needDefaultValue"}],staticClass:"box-card"},[a("div",{staticClass:"clearfix",staticStyle:{"line-height":"25px"},attrs:{slot:"header"},slot:"header"},[a("el-alert",{attrs:{closable:!1,title:"默认返回值，当后端Cluster无可用Server的时候，Gateway将返回这个默认值。可以用来做Mock或者后端服务故障时候的默认返回。",type:"warning"}})],1),t._v(" "),a("el-row",[a("el-col",{staticStyle:{"text-align":"right","padding-right":"8px"},attrs:{span:4}},[t._v("是否启动:")]),t._v(" "),a("el-col",{attrs:{span:10}},[a("el-switch",{attrs:{"active-color":"#13ce66","inactive-color":"#f1f1f1"},model:{value:t.tempItem.useDefault,callback:function(e){t.$set(t.tempItem,"useDefault",e)},expression:"tempItem.useDefault"}}),t._v(" "),a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",placement:"top-start"}},[a("div",{attrs:{slot:"content"},slot:"content"},[t._v("如果启用，则强制覆盖整体的默认值。")]),t._v(" "),a("i",{staticClass:"el-icon-info",staticStyle:{"margin-left":"10px",color:"#909399"}})])],1)],1),t._v(" "),a("el-row",{staticClass:"el-margin-bottom"},[a("el-col",{staticStyle:{"text-align":"right","padding-right":"8px"},attrs:{span:4}},[a("span",{staticClass:"red-icon"},[t._v("*")]),t._v(" 状态码:\n                            ")]),t._v(" "),a("el-col",{attrs:{span:10}},[a("el-input",{attrs:{placeholder:"例如：200，404，500"},model:{value:t.tempItem.defaultValue.code,callback:function(e){t.$set(t.tempItem.defaultValue,"code",t._n(e))},expression:"tempItem.defaultValue.code"}})],1)],1),t._v(" "),a("el-row",{staticClass:"el-margin-bottom"},[a("el-col",{staticStyle:{"text-align":"right","padding-right":"8px"},attrs:{span:4}},[t._v("body 内容:")]),t._v(" "),a("el-col",{attrs:{span:14}},[a("el-input",{attrs:{placeholder:"body 内容"},model:{value:t.tempItem.defaultValue.body,callback:function(e){t.$set(t.tempItem.defaultValue,"body",e)},expression:"tempItem.defaultValue.body"}})],1)],1),t._v(" "),a("el-row",{staticClass:"el-margin-bottom"},[a("el-col",{staticStyle:{"text-align":"right","padding-right":"8px"},attrs:{span:4}},[t._v("head 头部:")]),t._v(" "),a("el-col",{attrs:{span:20}},[t._l(t.tempItem.defaultValue.headers,function(e,i){return[a("el-row",{staticStyle:{"margin-bottom":"8px"}},[a("el-col",{attrs:{span:8}},[a("el-input",{attrs:{placeholder:"键"},model:{value:e.name,callback:function(a){t.$set(e,"name",a)},expression:"head.name"}})],1),t._v(" "),a("el-col",{staticStyle:{"text-align":"center"},attrs:{span:1}},[t._v("=")]),t._v(" "),a("el-col",{attrs:{span:8}},[a("el-input",{attrs:{placeholder:"值"},model:{value:e.value,callback:function(a){t.$set(e,"value",a)},expression:"head.value"}})],1),t._v(" "),0===i?a("el-col",{staticStyle:{"text-align":"center"},attrs:{span:1}},[a("span",{staticClass:"el-icon-circle-plus-outline",staticStyle:{cursor:"pointer"},attrs:{title:"添加"},on:{click:function(e){return t.addDefaultValueItem("head")}}})]):t._e(),t._v(" "),i>0?a("el-col",{staticStyle:{"text-align":"center"},attrs:{span:1}},[a("span",{staticClass:"el-icon-remove-outline",staticStyle:{cursor:"pointer"},attrs:{title:"删除"},on:{click:function(e){return t.removeDefaultValueItem("head",i)}}})]):t._e()],1)]})],2)],1),t._v(" "),a("el-row",{staticClass:"el-margin-bottom"},[a("el-col",{staticStyle:{"text-align":"right","padding-right":"8px"},attrs:{span:4}},[t._v("set Cookie:")]),t._v(" "),a("el-col",{attrs:{span:20}},[t._l(t.tempItem.defaultValue.cookies,function(e,i){return[a("el-row",{staticStyle:{"margin-bottom":"8px"}},[a("el-col",{attrs:{span:8}},[a("el-input",{attrs:{placeholder:"键"},model:{value:e.name,callback:function(a){t.$set(e,"name",a)},expression:"cookie.name"}})],1),t._v(" "),a("el-col",{staticStyle:{"text-align":"center"},attrs:{span:1}},[t._v("=")]),t._v(" "),a("el-col",{attrs:{span:8}},[a("el-input",{attrs:{placeholder:"值"},model:{value:e.value,callback:function(a){t.$set(e,"value",a)},expression:"cookie.value"}})],1),t._v(" "),0===i?a("el-col",{staticStyle:{"text-align":"center"},attrs:{span:1}},[a("span",{staticClass:"el-icon-circle-plus-outline",staticStyle:{cursor:"pointer"},attrs:{title:"添加"},on:{click:function(e){return t.addDefaultValueItem("cookie")}}})]):t._e(),t._v(" "),i>0?a("el-col",{staticStyle:{"text-align":"center"},attrs:{span:1}},[a("span",{staticClass:"el-icon-remove-outline",staticStyle:{cursor:"pointer"},attrs:{title:"删除"},on:{click:function(e){return t.removeDefaultValueItem("cookie",i)}}})]):t._e()],1)]})],2)],1)],1),t._v(" "),a("el-button",{directives:[{name:"show",rawName:"v-show",value:t.needDefaultValue,expression:"needDefaultValue"}],attrs:{type:"text"},on:{click:function(e){t.needDefaultValue=!1}}},[t._v("移除默认返回值\n                    ")])],1)],1)],1),t._v(" "),a("el-form-item",{attrs:{label:"websocket参数"}},[t.needWebsocket?[a("div",[a("el-input",{staticStyle:{width:"400px"},attrs:{placeholder:"origin"},model:{value:t.tempItem.webSocketOptions.origin,callback:function(e){t.$set(t.tempItem.webSocketOptions,"origin",e)},expression:"tempItem.webSocketOptions.origin"}})],1),t._v(" "),a("el-button",{attrs:{type:"text"},on:{click:function(e){t.needWebsocket=!1}}},[t._v("移除websocket参数")])]:[a("el-button",{attrs:{type:"text"},on:{click:function(e){t.needWebsocket=!0}}},[t._v("添加websocket参数")])]],2),t._v(" "),a("el-form-item",{attrs:{label:"Auth插件"}},[t.needAuthFilter?[a("div",[a("el-input",{staticStyle:{width:"450px"},attrs:{placeholder:"指定该API所使用的Auth插件名称，例如：jwt"},model:{value:t.tempItem.authFilter,callback:function(e){t.$set(t.tempItem,"authFilter",e)},expression:"tempItem.authFilter"}}),t._v(" "),a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",placement:"top-start"}},[a("div",{attrs:{slot:"content"},slot:"content"},[t._v("指定该API所使用的Auth插件名称。Auth插件的实现可以借鉴JWT插件")]),t._v(" "),a("i",{staticClass:"el-icon-info",staticStyle:{"margin-left":"10px",color:"#909399"}})])],1),t._v(" "),a("el-button",{attrs:{type:"text"},on:{click:function(e){t.needAuthFilter=!1}}},[t._v("移除authFilter参数")])]:[a("el-button",{attrs:{type:"text"},on:{click:function(e){t.needAuthFilter=!0}}},[t._v("添加authFilter参数")])]],2),t._v(" "),a("el-form-item",{staticStyle:{width:"700px"},attrs:{label:"标签(Tags)"}},[a("el-row",[a("el-col",[a("div",{directives:[{name:"show",rawName:"v-show",value:t.needTags,expression:"needTags"}],staticClass:"grid-content"},[a("el-card",{staticClass:"box-card"},[a("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[a("div",{staticStyle:{"line-height":"30px",color:"#999999"}},[t._v("标签")]),t._v(" "),a("el-input",{staticStyle:{display:"inline-block",width:"200px"},attrs:{placeholder:"标签的name"},model:{value:t.tempTag.name,callback:function(e){t.$set(t.tempTag,"name",e)},expression:"tempTag.name"}}),t._v(" "),a("div",{staticStyle:{display:"inline-block",width:"250px"}},[a("el-input",{attrs:{placeholder:"标签的value"},model:{value:t.tempTag.value,callback:function(e){t.$set(t.tempTag,"value",e)},expression:"tempTag.value"}},[a("el-button",{attrs:{slot:"append"},on:{click:function(e){return t.addTag()}},slot:"append"},[t._v("添加")])],1)],1)],1),t._v(" "),a("div",{staticClass:"text item"},t._l(t.tempItem.tags,function(e,i){return a("el-tag",{key:i,staticStyle:{"margin-right":"8px"},attrs:{type:"success",closable:""},on:{close:function(e){return t.removeTag(i)}}},[t._v(t._s(e.name)+"("+t._s(e.value)+")\n                                ")])}),1)]),t._v(" "),a("el-button",{attrs:{type:"text"},on:{click:function(e){t.needTags=!1}}},[t._v("移除标签")])],1),t._v(" "),a("el-button",{directives:[{name:"show",rawName:"v-show",value:!t.needTags,expression:"!needTags"}],attrs:{type:"text"},on:{click:function(e){t.needTags=!0}}},[t._v("添加标签")])],1)],1)],1),t._v(" "),a("el-form-item",{staticStyle:{width:"800px"},attrs:{label:"接口IP的访问控制"}},[a("el-row",{attrs:{gutter:10}},[a("el-col",{attrs:{span:11}},[a("div",{directives:[{name:"show",rawName:"v-show",value:t.needIpWhite,expression:"needIpWhite"}],staticClass:"grid-content"},[a("el-card",{staticClass:"box-card"},[a("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[a("div",{staticStyle:{"line-height":"30px",color:"#999999"}},[t._v("IP白名单")]),t._v(" "),a("el-input",{attrs:{placeholder:"IP格式 xxx:xxx:xxx"},model:{value:t.tempIp.white,callback:function(e){t.$set(t.tempIp,"white",e)},expression:"tempIp.white"}},[a("el-button",{attrs:{slot:"append"},on:{click:function(e){return t.addIpAccessControl("whitelist")}},slot:"append"},[t._v("添加")])],1)],1),t._v(" "),t._l(t.tempItem.ipAccessControl.whitelist,function(e,i){return a("div",{key:i,staticClass:"text item"},[t._v(t._s(e)+" "),a("span",{staticStyle:{float:"right",color:"#999999",cursor:"pointer"},on:{click:function(e){return t.removeIpAccessControl("whitelist",i)}}},[t._v("移除")])])})],2),t._v(" "),a("el-button",{attrs:{type:"text"},on:{click:function(e){t.needIpWhite=!1}}},[t._v("移除IP白名单选项")])],1),t._v(" "),a("el-button",{directives:[{name:"show",rawName:"v-show",value:!t.needIpWhite,expression:"!needIpWhite"}],attrs:{type:"text"},on:{click:function(e){t.needIpWhite=!0}}},[t._v("添加IP白名单选项")])],1),t._v(" "),a("el-col",{attrs:{span:11}},[a("div",{directives:[{name:"show",rawName:"v-show",value:t.needIpBlack,expression:"needIpBlack"}],staticClass:"grid-content"},[a("el-card",{staticClass:"box-card"},[a("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[a("div",{staticStyle:{"line-height":"30px",color:"#999999"}},[t._v("IP黑名单")]),t._v(" "),a("el-input",{attrs:{placeholder:"IP格式 xxx:xxx:xxx"},model:{value:t.tempIp.black,callback:function(e){t.$set(t.tempIp,"black",e)},expression:"tempIp.black"}},[a("el-button",{attrs:{slot:"append"},on:{click:function(e){return t.addIpAccessControl("blacklist")}},slot:"append"},[t._v("添加")])],1)],1),t._v(" "),t._l(t.tempItem.ipAccessControl.blacklist,function(e,i){return a("div",{key:i,staticClass:"text item"},[t._v(t._s(e)+" "),a("span",{staticStyle:{float:"right",color:"#999999",cursor:"pointer"},on:{click:function(e){return t.removeIpAccessControl("blacklist",i)}}},[t._v("移除")])])})],2),t._v(" "),a("el-button",{attrs:{type:"text"},on:{click:function(e){t.needIpBlack=!1}}},[t._v("移除IP黑名单选项")])],1),t._v(" "),a("el-button",{directives:[{name:"show",rawName:"v-show",value:!t.needIpBlack,expression:"!needIpBlack"}],attrs:{type:"text"},on:{click:function(e){t.needIpBlack=!0}}},[t._v("添加IP黑名单选项")])],1)],1)],1),t._v(" "),a("el-form-item",{staticStyle:{width:"700px"},attrs:{label:"重定义接口返回"}},[t.tempItem.renderTemplate.objects.length>0?a("el-row",[a("el-col",t._l(t.tempItem.renderTemplate.objects,function(e,i){return a("div",{key:i,staticClass:"grid-content"},[a("el-card",{staticClass:"box-card el-margin-bottom"},[a("div",{staticClass:"title_t"},[t._v("数据集 "+t._s(i+1)+"\n                                "),a("a",{staticStyle:{float:"right","font-size":"12px",color:"#999999",cursor:"pointer"},on:{click:function(e){return t.removeRenderTemplateItem(i)}}},[t._v("移除节点")])]),t._v(" "),a("el-row",[a("el-col",{staticStyle:{"text-align":"right","padding-right":"8px"},attrs:{span:6}},[t._v("字段名称:")]),t._v(" "),a("el-col",{attrs:{span:10}},[a("el-input",{attrs:{placeholder:"字段名称"},model:{value:e.name,callback:function(a){t.$set(e,"name","string"===typeof a?a.trim():a)},expression:"templateItem.name"}})],1)],1),t._v(" "),a("el-row",[a("el-col",{staticStyle:{"text-align":"right","padding-right":"8px"},attrs:{span:6}},[t._v("是否放置根节点:")]),t._v(" "),a("el-col",{attrs:{span:10}},[a("el-switch",{attrs:{"active-color":"#13ce66","inactive-color":"#f1f1f1"},model:{value:e.flatAttrs,callback:function(a){t.$set(e,"flatAttrs",a)},expression:"templateItem.flatAttrs"}}),t._v(" "),a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",placement:"top-start"}},[a("div",{attrs:{slot:"content"},slot:"content"},[t._v("如果开启了，则")]),t._v(" "),a("i",{staticClass:"el-icon-info",staticStyle:{"margin-left":"10px",color:"#909399"}})])],1)],1),t._v(" "),a("el-row",[a("el-col",{staticStyle:{"text-align":"right","padding-right":"8px"},attrs:{span:6}},[t._v("属性:")]),t._v(" "),a("el-col",{attrs:{span:18}},[t._l(e.attrs,function(i,s){return[a("el-row",{staticClass:"el-margin-bottom",attrs:{gutter:10}},[a("el-col",{attrs:{span:8}},[a("el-input",{attrs:{placeholder:"属性键"},model:{value:i.name,callback:function(e){t.$set(i,"name","string"===typeof e?e.trim():e)},expression:"attr.name"}})],1),t._v(" "),a("el-col",{attrs:{span:8}},[a("el-input",{attrs:{placeholder:"属性值"},model:{value:i.extractExp,callback:function(e){t.$set(i,"extractExp","string"===typeof e?e.trim():e)},expression:"attr.extractExp"}})],1),t._v(" "),0===s?a("el-col",{staticStyle:{"text-align":"center"},attrs:{span:1}},[a("span",{staticClass:"el-icon-circle-plus-outline",staticStyle:{cursor:"pointer"},attrs:{title:"添加"},on:{click:function(a){return t.addTemplateAttrItem(e)}}})]):t._e(),t._v(" "),s>0?a("el-col",{staticStyle:{"text-align":"center"},attrs:{span:1}},[a("span",{staticClass:"el-icon-remove-outline",staticStyle:{cursor:"pointer"},attrs:{title:"删除"},on:{click:function(a){return t.removeTemplateAttrItem(e,s)}}})]):t._e()],1)]})],2)],1)],1)],1)}),0)],1):t._e(),t._v(" "),a("el-row",[t.tempItem.renderTemplate.objects.length>0?a("div",{staticClass:"grid-content bg-purple",staticStyle:{padding:"0 5px","text-align":"right"}},[a("el-button",{staticClass:"add",attrs:{size:"mini",type:"primary",icon:"el-icon-plus"},on:{click:t.addRenderTemplateItem}},[t._v("新增节点\n                    ")])],1):a("el-button",{attrs:{type:"text"},on:{click:t.addRenderTemplateItem}},[t._v("新增节点")])],1)],1)],1)],1)},R=[];function A(){return{name:"",attrs:[{name:"",extractExp:""}],flatAttrs:!0}}function L(){return{code:"",body:"",headers:[{name:"",value:""}],cookies:[{name:"",value:""}]}}var M={name:"stepLast",props:{editItem:{type:Object},doValidate:{type:Boolean}},watch:{editItem:function(t,e){this.tempItem=Object(n["e"])(this.tempItem,Object(n["a"])(t)),this.tempItem.defaultValue.code&&(this.needDefaultValue=!0),this.tempItem.defaultValue.cookies&&0!=this.tempItem.defaultValue.cookies.length||(this.tempItem.defaultValue.cookies=[],this.tempItem.defaultValue.cookies.push({name:"",value:""})),this.tempItem.defaultValue.headers&&0!=this.tempItem.defaultValue.headers.length||(this.tempItem.defaultValue.headers=[],this.tempItem.defaultValue.headers.push({name:"",value:""})),this.tempItem.defaultValue.body&&(this.tempItem.defaultValue.body=Object(n["b"])(this.tempItem.defaultValue.body)),this.tempItem.ipAccessControl&&(this.tempItem.ipAccessControl.whitelist?this.tempItem.ipAccessControl.whitelist.length>0&&(this.needIpWhite=!0):this.tempItem.ipAccessControl.whitelist=[],this.tempItem.ipAccessControl.blacklist?this.tempItem.ipAccessControl.blacklist.length>0&&(this.needIpBlack=!0):this.tempItem.ipAccessControl.blacklist=[]),this.tempItem.tags&&this.tempItem.tags.length>0&&(this.needTags=!0),this.tempItem.perms&&this.tempItem.perms.length>0&&(this.needPerm=!0),this.tempItem.webSocketOptions&&this.tempItem.webSocketOptions.origin&&(this.needWebsocket=!0),this.tempItem.authFilter&&(this.needAuthFilter=!0)}},data:function(){return{tempIp:{white:"",black:""},tempTag:{name:"",value:""},tempPerm:"",tempItem:{ipAccessControl:{whitelist:[],blacklist:[]},defaultValue:L(),useDefault:!0,perms:[],tags:[],renderTemplate:{objects:[]},webSocketOptions:{origin:""},authFilter:""},timeTypeConstant:l["w"],needDefaultValue:!1,needTags:!1,needIpWhite:!1,needIpBlack:!1,needPerm:!1,needWebsocket:!1,needAuthFilter:!1}},mixins:[d],methods:{_formatFormData:function(){var t=Object(n["a"])(this.tempItem),e=!1;if(this.needDefaultValue){if(t.defaultValue.code||(e=!0,this._showMessage("填写默认返回的状态码。")),t.defaultValue.body&&(t.defaultValue.body=Object(n["c"])(t.defaultValue.body)),t.defaultValue.cookies&&t.defaultValue.cookies.length>0){var a=[];t.defaultValue.cookies.forEach(function(t){t.name&&t.value&&a.push(t)}),t.defaultValue.cookies=a}if(t.defaultValue.headers&&t.defaultValue.headers.length>0){var i=[];t.defaultValue.headers.forEach(function(t){t.name&&t.value&&i.push(t)}),t.defaultValue.headers=i}}else t.defaultValue=L(),t.useDefault=!1;return this.needTags||(t.tags=[]),this.needIpBlack||(t.ipAccessControl.blacklist=[]),this.needIpWhite||(t.ipAccessControl.whitelist=[]),this.needPerm||(t.perms=[]),this.needAuthFilter?t.authFilter||(e=!0,this._showMessage("请填写 authFilter 参数。")):t.authFilter="",this.needWebsocket?t.webSocketOptions.origin||(e=!0,this._showMessage("请填写 websocket 参数。")):t.webSocketOptions.origin="",{isError:e,result:t}},submitForm:function(){var t=this._formatFormData(),e=t.result,a=t.isError;this.$emit("submitFormStep",a,e)},addIpAccessControl:function(t){""!==this.tempIp.black&&"blacklist"===t&&(this.tempItem.ipAccessControl.blacklist.push(this.tempIp.black),this.tempIp.black=""),""!==this.tempIp.white&&"whitelist"===t&&(this.tempItem.ipAccessControl.whitelist.push(this.tempIp.white),this.tempIp.white="")},removeIpAccessControl:function(t,e){var a=this;this.$confirm("是否确定移除?","移除操作",{confirmButtonText:"确定",confirmButtonClass:"el-button--danger",cancelButtonText:"取消",type:"warning"}).then(function(){"blacklist"===t&&a.tempItem.ipAccessControl.blacklist.splice(e,1),"whitelist"===t&&a.tempItem.ipAccessControl.whitelist.splice(e,1)}).catch(function(){})},addDefaultValueItem:function(t){var e={name:"",value:""};"head"===t?this.tempItem.defaultValue.headers.push(e):"cookie"===t&&this.tempItem.defaultValue.cookies.push(e)},removeDefaultValueItem:function(t,e){var a=this;this.$confirm("是否确定移除?","移除操作",{confirmButtonText:"确定",confirmButtonClass:"el-button--danger",cancelButtonText:"取消",type:"warning"}).then(function(){"head"===t&&a.tempItem.defaultValue.headers.splice(e,1),"cookie"===t&&a.tempItem.defaultValue.cookies.splice(e,1)}).catch(function(){})},addTag:function(){this.tempItem.tags.push(this.tempTag),this.tempTag={name:"",value:""}},removeTag:function(t){var e=this;this.$confirm("是否确定移除?","移除操作",{confirmButtonText:"确定",confirmButtonClass:"el-button--danger",cancelButtonText:"取消",type:"warning"}).then(function(){e.tempItem.tags.splice(t,1)}).catch(function(){})},addPerm:function(){this.tempItem.perms.push(this.tempPerm),this.tempPerm=""},removePerm:function(t){var e=this;this.$confirm("是否确定移除?","移除操作",{confirmButtonText:"确定",confirmButtonClass:"el-button--danger",cancelButtonText:"取消",type:"warning"}).then(function(){e.tempItem.perms.splice(t,1)}).catch(function(){})},addRenderTemplateItem:function(){var t=A();this.tempItem.renderTemplate.objects.push(t)},removeRenderTemplateItem:function(t){var e=this;this.$confirm("是否确定移除?","移除操作",{confirmButtonText:"确定",confirmButtonClass:"el-button--danger",cancelButtonText:"取消",type:"warning"}).then(function(){e.tempItem.renderTemplate.objects.splice(t,1)}).catch(function(){})},addTemplateAttrItem:function(t){var e={name:"",extractExp:""};t.attrs.push(e)},removeTemplateAttrItem:function(t,e){this.$confirm("是否确定移除?","移除操作",{confirmButtonText:"确定",confirmButtonClass:"el-button--danger",cancelButtonText:"取消",type:"warning"}).then(function(){t.attrs.splice(e,1)}).catch(function(){})}}},E=M,U=(a("9b43f"),Object(f["a"])(E,F,R,!1,null,"7ba912a6",null)),H=U.exports;function Q(){var t={id:void 0,name:void 0,urlPattern:void 0,method:"*",domain:"",status:!0,ipAccessControl:{whitelist:[],blacklist:[]},defaultValue:{code:"",body:"",headers:[],cookies:[]},nodes:[],perms:[],authFilter:void 0,renderTemplate:{objects:[]},useDefault:!0,matchRule:l["m"].matchAny,position:0,tags:[],webSocketOptions:{origin:""},circuitBreaker:{closeTimeout:0,closeTimeoutType:l["y"].second,rateCheckPeriod:0,rateCheckPeriodType:l["y"].second,halfTrafficRate:"",failureRateToClose:"",succeedRateToOpen:""},maxQPS:void 0};return t}function W(){return{name:void 0,urlPattern:void 0,method:"*",domain:"",status:!0,position:0,matchRule:l["m"].matchAny}}function q(){return{nodes:[]}}function z(){return{maxQPS:void 0,circuitBreaker:{closeTimeout:0,closeTimeoutType:l["y"].second,rateCheckPeriod:0,rateCheckPeriodType:l["y"].second,halfTrafficRate:"",failureRateToClose:"",succeedRateToOpen:""}}}function G(){return{ipAccessControl:{whitelist:[],blacklist:[]},defaultValue:{code:"",body:"",headers:[{name:"",value:""}],cookies:[{name:"",value:""}]},useDefault:!0,perms:[],tags:[],webSocketOptions:{origin:""},authFilter:"",renderTemplate:{objects:[]}}}var K={name:"ApiForm",components:{StepFirst:x,StepNext:V,StepLast:H,StepNextNext:j},props:{showType:{type:String,default:l["d"].create},editItem:{type:Object}},data:function(){return{step:l["t"].first,loading:!0,submitting:!1,tempItem:Q(),stepFirstData:{},stepNextData:{},stepNextNextData:{},stepLastData:{},validateStepFirst:!1,validateStepNext:!1,validateStepNextNext:!1,validateStepLast:!1,toStep:-1}},computed:{isShow:function(){return this._isShow()},isCreate:function(){return this._isCreate()},isUpdate:function(){return this._isUpdate()},isFirstStep:function(){return this._isFirstStep()},isNextStep:function(){return this._isNextStep()},isNextNextStep:function(){return this._isNextNextStep()},isLastStep:function(){return this._isLastStep()}},watch:{editItem:function(t,e){var a=Object(n["a"])(t);this.tempItem=Object(n["e"])(this.tempItem,a),this.stepFirstData=Object(n["e"])(W(),a),this.stepNextData=Object(n["e"])(q(),a),this.stepNextNextData=Object(n["e"])(z(),a),this.stepLastData=Object(n["e"])(G(),a),this.loading=!1,this.submitting=!1,this.updateData()}},created:function(){this.init()},methods:{init:function(){this._isCreate()&&(this.loading=!1)},updateData:function(){this.stepFirstData=Object(n["e"])(this.stepFirstData,this.tempItem),this.stepNextData=Object(n["e"])(this.stepNextData,this.tempItem),this.stepNextNextData=Object(n["e"])(this.stepNextNextData,this.tempItem),this.stepLastData=Object(n["e"])(this.stepLastData,this.tempItem)},createItem:function(){this._isLastStep()&&(this.validateStepLast=!0)},_doCreateItem:function(){var t=this,e=this._formatFormData();this.submitting=!0,o["d"](e).then(function(){t.$message({type:"success",message:"创建成功!"}),setTimeout(function(){t.goList()},2e3)}).catch(function(){t.validateStepLast=!1,t.submitting=!1})},updateItem:function(){this._isLastStep()&&(this.validateStepLast=!0)},_doUpdateItem:function(){var t=this,e=this._formatFormData();this.submitting=!0,o["d"](e).then(function(){t.$message({type:"success",message:"修改成功!"}),setTimeout(function(){t.goList()},2e3)}).catch(function(){t.validateStepLast=!1,t.submitting=!1})},_formatFormData:function(){var t=Object(n["a"])(this.tempItem);return t.status=t.status?1:0,t.defaultValue.cookies&&0!==t.defaultValue.cookies.length||delete t.defaultValue.cookies,t.defaultValue.headers&&0!==t.defaultValue.headers.length||delete t.defaultValue.headers,t.defaultValue.body||delete t.defaultValue.body,t.defaultValue.code||delete t.defaultValue,t.ipAccessControl.whitelist&&0!==t.ipAccessControl.whitelist.length||delete t.ipAccessControl.whitelist,t.ipAccessControl.blacklist&&0!==t.ipAccessControl.blacklist.length||delete t.ipAccessControl.blacklist,t.ipAccessControl.blacklist||t.ipAccessControl.whitelist||delete t.ipAccessControl,0===t.perms.length&&delete t.perms,0===t.tags.length&&delete t.tags,0===t.nodes.length&&delete t.nodes,t.renderTemplate.objects&&0===t.renderTemplate.objects.length&&delete t.renderTemplate,t.webSocketOptions&&!t.webSocketOptions.origin&&delete t.webSocketOptions,t.circuitBreaker&&!t.circuitBreaker.closeTimeout&&delete t.circuitBreaker,t.maxQPS||delete t.maxQPS,t},goList:function(){this.$router.replace({path:"/api"}),this.$destroy()},handleSubmitFormStepFirst:function(t,e){if(this.validateStepFirst=!1,t)return this.toStep=-1,!1;var a=Object(n["a"])(e);this.increaseStep(),this.tempItem=Object(n["e"])(this.tempItem,a)},handleSubmitFormStepNext:function(t,e){if(this.validateStepNext=!1,t)return this.toStep=-1,!1;var a=Object(n["a"])(e);this.increaseStep(),this.tempItem=Object(n["e"])(this.tempItem,a)},handleSubmitFormStepNextNext:function(t,e){if(this.validateStepNextNext=!1,t)return this.toStep=-1,!1;var a=Object(n["a"])(e);this.increaseStep(),this.tempItem=Object(n["e"])(this.tempItem,a)},handleSubmitFormStepLast:function(t,e){if(this.validateStepLast=!1,t)return this.toStep=-1,!1;if(!this.submitting){var a=Object(n["a"])(e);this.tempItem=Object(n["e"])(this.tempItem,a),this._isUpdate()?this._doUpdateItem():this._isCreate()&&this._doCreateItem()}},nextStep:function(t){t||(this.toStep=-1),this._isFirstStep()?this.validateStepFirst=!0:this._isNextStep()?this.validateStepNext=!0:this._isNextNextStep()&&(this.validateStepNextNext=!0)},preStep:function(){this.decreaseStep(),this.toStep=-1},increaseStep:function(){var t=this;this.step>3||(this.step=this.step+1,this.step===this.toStep&&(this.toStep=-1),this.toStep>this.step&&this.$nextTick(function(){t.nextStep(!0)}))},decreaseStep:function(){this.step<1||(this.step=this.step-1)},handleToStep:function(t){var e=this.step,a=t;t!==e&&(a>e?(this.toStep=a,this.nextStep(!0)):(this.step=a,this.toStep=-1))},_isUpdate:function(){return this.showType===l["d"].update},_isShow:function(){return this.showType===l["d"].show},_isCreate:function(){return this.showType===l["d"].create},_isFirstStep:function(){return this.step===l["t"].first},_isNextStep:function(){return this.step===l["t"].next},_isNextNextStep:function(){return this.step===l["t"].nextNext},_isLastStep:function(){return this.step===l["t"].last}}},J=K,X=(a("42e2"),a("476a"),Object(f["a"])(J,i,s,!1,null,"3d54e8fd",null));e["a"]=X.exports},"58c8":function(t,e,a){"use strict";var i=a("dc51"),s=a.n(i);s.a},"7ea2":function(t,e,a){"use strict";a.d(e,"b",function(){return o}),a.d(e,"d",function(){return r}),a.d(e,"e",function(){return c}),a.d(e,"a",function(){return u}),a.d(e,"c",function(){return p});var i=a("b775"),s=a("2435"),l="/clusters";function n(t){return Object(i["a"])({url:l,method:"GET",params:t})}function o(){return new Promise(function(t,e){var a=[],i="",l=s["c"];function o(s){n(s).then(function(e){e=e||[];var s=e.length;if(s>0){if(a=a.concat(e),i=e[s-1]||{},i.id){var n={after:i.id,limit:l};o(n)}}else t(a)}).catch(function(){e()})}var r={after:"",limit:l};o(r)})}function r(t){return Object(i["a"])({url:l+"/"+t,method:"GET"})}function c(t){return Object(i["a"])({url:l,method:"PUT",data:t})}function u(t){return Object(i["a"])({url:l+"/"+t,method:"DELETE"})}function p(t){return Object(i["a"])({url:l+"/"+t+"/binds",method:"GET"})}},"9b43f":function(t,e,a){"use strict";var i=a("edc2"),s=a.n(i);s.a},a273:function(t,e,a){"use strict";var i=a("40ce"),s=a.n(i);s.a},ac70:function(t,e,a){},b775:function(t,e,a){"use strict";var i=a("bc3a"),s=a.n(i),l=a("5c96"),n="",o="",r=o+"/v1",c=s.a.create({baseURL:n+r,timeout:6e4});c.interceptors.request.use(function(t){return t},function(t){console.error(t),Promise.reject(t)}),c.interceptors.response.use(function(t){var e=t.data||{};t.headers;return 0===e.code?e.data:(Object(l["Message"])({message:e.data,type:"error",duration:5e3}),Promise.reject("error"))},function(t){return Object(l["Message"])({message:t.data||"网络异常",type:"error",duration:5e3}),Promise.reject(t)}),e["a"]=c},dc51:function(t,e,a){},edc2:function(t,e,a){}}]);